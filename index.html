<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iran Protest Map</title>
    <link rel="icon" type="image/jpeg" href="./Iran.jpg">
    <link rel="apple-touch-icon" href="./Iran.jpg">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Google Fonts for Farsi -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* CRITICAL FIX for Leaflet in RTL mode */
        .leaflet-container {
            direction: ltr !important; 
        }

        /* Animations */
        @keyframes slide-in-right {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-in-left {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .animate-slide-in-right {
            animation: slide-in-right 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .animate-slide-in-left {
            animation: slide-in-left 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fade-in 0.2s ease-out;
        }

        /* Custom Loading Spinner (Iran Flag Colors) */
        @keyframes spin-slow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .iran-loader {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: #22c55e; /* Green */
            border-bottom-color: #ef4444; /* Red */
            border-left-color: #22c55e; /* Green */
            border-right-color: #ef4444; /* Red */
            animation: spin-slow 1.5s linear infinite;
            position: relative;
        }
        .iran-loader::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }

        /* Flag Stained Glass Theme for Timeline */
        .timeline-flag-glass {
            background: linear-gradient(
                180deg, 
                rgba(34, 197, 94, 0.15) 0%, 
                rgba(255, 255, 255, 0.5) 45%, 
                rgba(255, 255, 255, 0.5) 55%, 
                rgba(239, 68, 68, 0.15) 100%
            );
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-theme .timeline-flag-glass {
             background: linear-gradient(
                180deg, 
                rgba(34, 197, 94, 0.15) 0%, 
                rgba(255, 255, 255, 0.1) 45%, 
                rgba(255, 255, 255, 0.1) 55%, 
                rgba(239, 68, 68, 0.15) 100%
            );
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* Leaflet Tooltip Customization */
        .leaflet-tooltip-pane .custom-tooltip {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            color: #1f2937;
            padding: 8px 12px;
            width: max-content;
            max-width: min(460px, 90vw);
            white-space: normal;
            text-align: center;
            line-height: 1.4;
            transition: all 0.3s ease;
        }
        .leaflet-tooltip-pane .custom-tooltip::before {
            border-top-color: rgba(255, 255, 255, 0.95);
        }

        /* Dark Mode Tooltip Overrides */
        body.dark-theme .leaflet-tooltip-pane .custom-tooltip {
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #f3f4f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }
        body.dark-theme .leaflet-tooltip-pane .custom-tooltip::before {
            border-top-color: rgba(17, 24, 39, 0.95);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Slider Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #4b5563; cursor: pointer; margin-top: -6px; box-shadow: 0 0 2px rgba(0,0,0,0.5); transition: transform 0.1s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: rgba(156, 163, 175, 0.5); border-radius: 2px; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-moz-range-track { width: 100%; height: 4px; cursor: pointer; background: rgba(156, 163, 175, 0.5); border-radius: 2px; }
        input[type=range]::-moz-range-thumb { height: 16px; width: 16px; border: none; border-radius: 50%; background: #4b5563; cursor: pointer; box-shadow: 0 0 2px rgba(0,0,0,0.5); }
    </style>
</head>
<body class="bg-gray-100 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Icons ---
        const IconSun = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>;
        const IconMoon = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>;
        const IconZoomIn = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>;
        const IconZoomOut = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>;
        const IconInfo = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>;
        const IconX = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const IconCalendar = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const IconMapPin = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>;
        const IconExternalLink = ({ className = "w-3 h-3" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>;
        const IconChart = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>;
        const IconRefresh = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;
        const IconPlay = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const IconPause = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>;
        const IconAlert = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>;

        // --- Translations ---
        const translations = {
            en: {
                title: "Iran Protest Map",
                subtitle: "Verified Incident Tracker • {count} Events Visible",
                largeCrowd: "Large Crowd",
                mediumCrowd: "Medium Crowd",
                smallGroup: "Small Group",
                unverified: "Unverified",
                showChart: "Show Chart",
                showUnverified: "Show Unverified",
                hideUnverified: "Hide Unverified",
                timeline: "Timeline Control",
                showingAll: "Showing All Events",
                all: "All",
                chartTitle: "Protest Activity Over Time",
                chartNote: "Note: Date reflects date of tweet, not necessarily the date of the incident.",
                total: "Total",
                large: "Large",
                medium: "Medium",
                small: "Small",
                incidentDetails: "Incident Details",
                date: "Date",
                dateNote: "Date reflects tweet date.",
                location: "Location",
                description: "Description",
                footage: "Footage",
                altAngle: "Alt Angle",
                viewOnX: "View on X",
                clickForInfo: "Click for more info"
            },
            fa: {
                title: "نقشه اعتراضات ایران",
                subtitle: "ردیاب حوادث تایید شده • {count} رویداد قابل مشاهده",
                largeCrowd: "جمعیت زیاد",
                mediumCrowd: "جمعیت متوسط",
                smallGroup: "گروه کوچک",
                unverified: "تأیید نشده",
                showChart: "نمایش نمودار",
                showUnverified: "نمایش تأیید نشده",
                hideUnverified: "پنهان کردن تأیید نشده",
                timeline: "کنترل زمانی",
                showingAll: "نمایش همه رویدادها",
                all: "همه",
                chartTitle: "فعالیت اعتراضات در طول زمان",
                chartNote: "توجه: تاریخ منعکس کننده تاریخ توییت است، نه لزوماً تاریخ حادثه.",
                total: "کل",
                large: "بزرگ",
                medium: "متوسط",
                small: "کوچک",
                incidentDetails: "جزئیات حادثه",
                date: "تاریخ",
                dateNote: "تاریخ منعکس کننده تاریخ توییت است.",
                location: "مکان",
                description: "توضیحات",
                footage: "ویدیو",
                altAngle: "زاویه دیگر",
                viewOnX: "مشاهده در X",
                clickForInfo: "برای اطلاعات بیشتر کلیک کنید"
            }
        };

        // --- Tweet Component (Optimized) ---
        const TweetEmbed = ({ url, isDarkMode }) => {
            const containerRef = useRef(null);
            const [isLoading, setIsLoading] = useState(true);
            const theme = isDarkMode ? 'dark' : 'light';

            useEffect(() => {
                if (!url || !containerRef.current) return;
                setIsLoading(true);
                const tweetId = url.split('/').pop().split('?')[0];
                containerRef.current.innerHTML = ''; 

                const renderTweet = () => {
                    if (window.twttr && window.twttr.widgets) {
                        window.twttr.widgets.createTweet(
                            tweetId,
                            containerRef.current,
                            { theme: theme, conversation: 'none', align: 'center' }
                        ).then(() => {
                            setIsLoading(false);
                        });
                    }
                };

                if (window.twttr && window.twttr.widgets) {
                    renderTweet();
                } else {
                    const script = document.createElement('script');
                    script.src = 'https://platform.twitter.com/widgets.js';
                    script.async = true;
                    script.onload = renderTweet;
                    document.body.appendChild(script);
                }
            }, [url, theme]);

            return (
                <div className={`relative rounded-xl overflow-hidden border transition-all duration-300 ${isLoading ? 'min-h-[250px]' : ''} ${isDarkMode ? 'border-gray-700' : 'border-gray-200'} ${isLoading ? (isDarkMode ? 'bg-gray-900' : 'bg-gray-50') : 'bg-transparent border-none'}`}>
                   {isLoading && (
                       <div className="absolute inset-0 flex items-center justify-center z-0">
                           <div className="iran-loader"></div>
                       </div>
                   )}
                   <div ref={containerRef} className="relative z-10 w-full flex items-center justify-center"></div>
                </div>
            );
        };

        // --- Graph Component ---
        const ProtestGraph = ({ data, onClose, isDarkMode, t, lang }) => {
            const processedData = useMemo(() => {
                const dates = [...new Set(data.map(d => d.date))].sort();
                const series = dates.map(date => {
                    const dayEvents = data.filter(d => d.date === date);
                    return {
                        date,
                        total: dayEvents.length,
                        small: dayEvents.filter(d => d.size === 'small' && d.verified).length,
                        medium: dayEvents.filter(d => d.size === 'medium' && d.verified).length,
                        big: dayEvents.filter(d => d.size === 'big' && d.verified).length,
                        unverified: dayEvents.filter(d => !d.verified).length
                    };
                });
                return { dates, series };
            }, [data]);

            const { dates, series } = processedData;
            const height = 200; const width = 500; const padding = 30;
            const graphWidth = width - padding * 2; const graphHeight = height - padding * 2;
            const maxVal = Math.max(...series.map(s => s.total), 5); 
            const getX = (index) => padding + (index / (dates.length - 1)) * graphWidth;
            const getY = (val) => height - padding - (val / maxVal) * graphHeight;
            const createPath = (key) => {
                if (series.length === 0) return "";
                return "M" + series.map((p, i) => `${getX(i)},${getY(p[key])}`).join(" L");
            };

            const textColor = isDarkMode ? "text-gray-200" : "text-gray-600";
            const bgColor = isDarkMode ? "bg-gray-900/90 border-gray-700" : "bg-white/95 border-white/20";

            return (
                <div className="fixed inset-0 z-[2001] flex items-center justify-center p-4" dir={lang === 'fa' ? 'rtl' : 'ltr'}>
                     <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={onClose}></div>
                     <div className={`relative ${bgColor} backdrop-blur-xl border shadow-2xl rounded-2xl p-6 w-full max-w-2xl animate-fade-in`}>
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>{t.chartTitle}</h2>
                                <p className={`text-xs text-gray-400 italic mt-1 ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>{t.chartNote}</p>
                            </div>
                            <button onClick={onClose} className={`p-2 rounded-full transition-colors ${isDarkMode ? 'hover:bg-gray-800 text-gray-400' : 'hover:bg-gray-100 text-gray-500'}`}><IconX className="w-5 h-5 md:w-6 md:h-6" /></button>
                        </div>
                        <div className="overflow-x-auto" dir="ltr"> 
                            <svg width="100%" height={height} viewBox={`0 0 ${width} ${height}`} className="overflow-visible">
                                {[0, 0.25, 0.5, 0.75, 1].map((tick) => (
                                    <line key={tick} x1={padding} y1={getY(tick * maxVal)} x2={width - padding} y2={getY(tick * maxVal)} stroke={isDarkMode ? "#374151" : "#e5e7eb"} strokeDasharray="4 4" />
                                ))}
                                <path d={createPath('total')} fill="none" stroke="#60A5FA" strokeWidth="3" />
                                <path d={createPath('big')} fill="none" stroke="#EF4444" strokeWidth="2" strokeDasharray="5 5" />
                                <path d={createPath('medium')} fill="none" stroke="#F97316" strokeWidth="2" strokeDasharray="3 3" />
                                <path d={createPath('small')} fill="none" stroke="#FACC15" strokeWidth="2" />
                                <path d={createPath('unverified')} fill="none" stroke="#9CA3AF" strokeWidth="2" strokeDasharray="2 2" />
                                
                                {series.map((p, i) => <circle key={i} cx={getX(i)} cy={getY(p.total)} r="3" fill="#60A5FA" />)}
                                {series.map((p, i) => <text key={i} x={getX(i)} y={height - 5} fontSize="8" textAnchor="middle" fill={isDarkMode ? "#9CA3AF" : "#6B7280"}>{p.date.slice(5)}</text>)}
                            </svg>
                        </div>
                        <div className={`flex justify-center flex-wrap gap-x-4 gap-y-2 mt-6 text-xs font-medium ${lang === 'fa' ? 'space-x-reverse font-[Vazirmatn]' : ''}`}>
                            <div className="flex items-center"><span className="w-3 h-1 bg-blue-400 rounded mr-2 ml-1"></span><span className={textColor}>{t.total}</span></div>
                            <div className="flex items-center"><span className="w-3 h-1 bg-red-500 rounded mr-2 ml-1 border border-dashed border-white"></span><span className={textColor}>{t.large}</span></div>
                            <div className="flex items-center"><span className="w-3 h-1 bg-orange-500 rounded mr-2 ml-1 border border-dotted border-white"></span><span className={textColor}>{t.medium}</span></div>
                            <div className="flex items-center"><span className="w-3 h-1 bg-yellow-400 rounded mr-2 ml-1"></span><span className={textColor}>{t.small}</span></div>
                            <div className="flex items-center"><span className="w-3 h-1 bg-gray-400 rounded mr-2 ml-1 border border-dashed border-white"></span><span className={textColor}>{t.unverified}</span></div>
                        </div>
                     </div>
                </div>
            );
        };

        const IranMap = () => {
            const mapContainerRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const tileLayerRef = useRef(null);
            const markersRef = useRef([]); 
            
            const [isMapReady, setIsMapReady] = useState(false);
            const [activeLayer, setActiveLayer] = useState('light');
            const [zoomLevel, setZoomLevel] = useState(5);
            const [selectedIncident, setSelectedIncident] = useState(null);
            const [showGraph, setShowGraph] = useState(false);
            const [showUnverified, setShowUnverified] = useState(false);
            const [dateFilter, setDateFilter] = useState(null); 
            const [isPlaying, setIsPlaying] = useState(false);
            const [lang, setLang] = useState('en'); 

            const isDarkMode = activeLayer === 'dark' || activeLayer === 'satellite';
            const t = translations[lang];

            useEffect(() => { document.body.classList.toggle('dark-theme', isDarkMode); }, [isDarkMode]);

            // --- Preload Twitter Script ---
            useEffect(() => {
                if (!document.getElementById('twitter-wjs')) {
                    const script = document.createElement('script');
                    script.id = 'twitter-wjs';
                    script.src = 'https://platform.twitter.com/widgets.js';
                    script.async = true;
                    document.body.appendChild(script);
                }
            }, []);

            // --- Verified Data ---
            const verifiedIncidents = useMemo(() => [
                { "id": 1, "verified": true, "desc": "Protesters push back police and security forces on Jomhouri Street, Tehran", "desc_fa": "عقب راندن نیروهای پلیس و امنیتی توسط معترضان در خیابان جمهوری تهران", "coords": [35.6927461, 51.4255329], "link": "https://x.com/Shayan86/status/2005987583445090377", "date": "2025-12-30", "size": "big", "alt": null },
                { "id": 2, "verified": true, "desc": "Protesters outside Ghasr shopping centre on Qeshm Island", "desc_fa": "تجمع معترضان مقابل مرکز خرید قصر در جزیره قشم", "coords": [26.968793, 56.075395], "link": "https://x.com/Shayan86/status/2005999164979867916", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": 3, "verified": true, "desc": "Group gathered in Tehran", "desc_fa": "تجمع گروهی از مردم در تهران", "coords": [35.752619, 51.466106], "link": "https://x.com/GhonchehAzad/status/2005992119258038527", "date": "2025-12-30", "size": "big", "alt": null },
                { "id": 4, "verified": true, "desc": "Protester sits down in front of forces outside Charsou shopping centre on Jomhouri Street, Tehran", "desc_fa": "تحصن یک معترض مقابل نیروهای امنیتی روبروی پاساژ چارسو در خیابان جمهوری تهران", "coords": [35.695143, 51.412703], "link": "https://x.com/Shayan86/status/2006018573769019635", "date": "2025-12-30", "size": "small", "alt": null },
                { "id": 5, "verified": true, "desc": "Unrest with students running at University of Tehran", "desc_fa": "ناآرامی و شعار دادن دانشجویان در دانشگاه تهران (شعار مرگ بر دیکتاتور و آزادی)", "coords": [35.7036777, 51.3956859], "link": "https://x.com/GhonchehAzad/status/2006018665456501147", "date": "2025-12-30", "size": "medium", "alt": "https://x.com/Shayan86/status/2006039256603513166" },
                { "id": 6, "verified": true, "desc": "Woman leads chants of \"don't be afraid, we're all together\" in Tehran's Grand Bazaar", "desc_fa": "شعار «نترسید نترسید ما همه با هم هستیم» توسط یک زن در بازار بزرگ تهران", "coords": [35.6727692, 51.4214139], "link": "https://x.com/Shayan86/status/2006051668295647391", "date": "2025-12-30", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006036269298512269" },
                { "id": 7, "verified": true, "desc": "Clashes between police and protesters in Hamedan", "desc_fa": "درگیری بین پلیس و معترضان در همدان", "coords": [34.7954883, 48.5143633], "link": "https://x.com/GhonchehAzad/status/2006077897610797143", "date": "2025-12-30", "size": "medium", "alt": "https://x.com/Shayan86/status/2006728257450946936" },
                { "id": 8, "verified": true, "desc": "Man calls for help as protesters run from forces on Rajaei Street, Arak", "desc_fa": "درخواست کمک مردم در حالی که معترضان از نیروهای امنیتی در خیابان رجایی اراک فرار می‌کنند", "coords": [34.084962, 49.691045], "link": "https://x.com/Shayan86/status/2006174541567898093", "date": "2025-12-31", "size": "small", "alt": null },
                { "id": 9, "verified": true, "desc": "Shots fired at protesters on Imam Khomeini Street, Fasa", "desc_fa": "تیراندازی به سمت معترضان در خیابان امام خمینی فسا", "coords": [28.939864, 53.647716], "link": "https://x.com/Shayan86/status/2006332899751301458", "date": "2025-12-31", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2006331110993883448" },
                { "id": 10, "verified": true, "desc": "Protesters remove entrance gate of local government building in Fasa", "desc_fa": "معترضان در فرمانداری فسا را از جا کندند", "coords": [28.940212, 53.648819], "link": "https://x.com/Shayan86/status/2006412023597355302", "date": "2025-12-31", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006319069432012957" },
                { "id": 11, "verified": true, "desc": "Shots fired towards protesters at Imam Khomeini Square, Kuhdasht", "desc_fa": "تیراندازی به سمت معترضان در میدان امام خمینی کوهدشت", "coords": [33.533535, 47.607890], "link": "https://x.com/Shayan86/status/2006418603029987588", "date": "2025-12-31", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006403148684943839" },
                { "id": 12, "verified": true, "desc": "Protesters in Ramhormoz", "desc_fa": "تجمع معترضان در رامهرمز", "coords": [31.2800698, 49.6083711], "link": "https://x.com/GhonchehAzad/status/2006472230344220830", "date": "2025-12-31", "size": "medium", "alt": null },
                { "id": 13, "verified": true, "desc": "At least one individual arrested in front of Shahid Beheshti University dormitory, Tehran", "desc_fa": "بازداشت حداقل یک نفر مقابل خوابگاه دانشگاه شهید بهشتی تهران", "coords": [35.8059661, 51.3938244], "link": "https://x.com/GhonchehAzad/status/2006484693064270278", "date": "2025-12-31", "size": "small", "alt": null },
                { "id": 14, "verified": true, "desc": "Protests with fires and chants against Khamenei in Fuladshahr, Isfahan Province", "desc_fa": "اعتراضات، آتش زدن و شعار علیه خامنه‌ای در فولادشهر اصفهان", "coords": [32.482246, 51.404348], "link": "https://x.com/GeoConfirmed/status/2006392706881253489", "date": "2025-12-31", "size": "medium", "alt": null },
                { "id": 15, "verified": true, "desc": "Protesters set fire to local police station in Azna", "desc_fa": "به آتش کشیدن کانکس پلیس توسط معترضان در ازنا", "coords": [33.460733, 49.451621], "link": "https://x.com/Shayan86/status/2006850300645355614", "date": "2026-01-01", "size": "small", "alt": null },
                { "id": 16, "verified": true, "desc": "Chants of \"don't be afraid, we're all together\" in Karaj", "desc_fa": "شعار «نترسید ما همه با هم هستیم» در کرج", "coords": [35.842676, 50.971310], "link": "https://x.com/Shayan86/status/2006867020508430504", "date": "2026-01-01", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006811169957585230" },
                { "id": 17, "verified": true, "desc": "Protesters attacking and clashing with security forces in Marlik, Malard, Tehran Province", "desc_fa": "حمله و درگیری معترضان با نیروهای امنیتی در مارلیک ملارد", "coords": [35.69949, 50.98223], "link": "https://x.com/GeoConfirmed/status/2006767204038049828", "date": "2026-01-01", "size": "medium", "alt": "https://x.com/mhmiranusa/status/2006583893114204439" },
                { "id": 18, "verified": true, "desc": "Protesters pelt stones at bike-riding security forces on Del Azad Boulevard, Qom", "desc_fa": "پرتاب سنگ توسط معترضان به نیروهای امنیتی موتورسوار در بلوار دل‌آذر قم", "coords": [34.635653, 50.903530], "link": "https://x.com/Shayan86/status/2006883608489803839", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 19, "verified": true, "desc": "Protesters chant \"freedom, freedom, freedom\" on Maliabad Boulevard, Shiraz", "desc_fa": "شعار «آزادی آزادی آزادی» معترضان در بلوار معالی‌آباد شیراز", "coords": [29.6813125, 52.4621809], "link": "https://x.com/Shayan86/status/2007140469575463141", "date": "2026-01-02", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2006840481955852628" },
                { "id": 20, "verified": true, "desc": "Protesters march chanting in support of Pahlavi dynasty in central Marvdasht", "desc_fa": "راهپیمایی و شعار در حمایت از پهلوی در مرکز مرودشت", "coords": [29.874124, 52.800150], "link": "https://x.com/Shayan86/status/2007143719263420764", "date": "2026-01-02", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2006729302105104558" },
                { "id": 21, "verified": true, "desc": "Group gathers outside government-linked building with explosion heard in Lordegan", "desc_fa": "تجمع و شنیده شدن صدای انفجار مقابل یک ساختمان دولتی در لردگان", "coords": [31.519264, 50.824531], "link": "https://x.com/Shayan86/status/2007145981104795668", "date": "2026-01-02", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006726390729814444" },
                { "id": 22, "verified": true, "desc": "Protesters chant \"people of Iran, scream and shout for your rights\" on Shariati Street, Babol", "desc_fa": "شعار «ایرانی داد بزن حقتو فریاد بزن» در خیابان شریعتی بابل", "coords": [36.565107, 52.678999], "link": "https://x.com/Shayan86/status/2007155657775227083", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 23, "verified": true, "desc": "Security forces detain a young woman near Haft Hoz Square, east Tehran", "desc_fa": "بازداشت خشونت‌آمیز یک زن جوان توسط نیروهای امنیتی در میدان هفت‌حوض تهران", "coords": [35.731604, 51.494020], "link": "https://x.com/Shayan86/status/2007158833781637299", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": 24, "verified": true, "desc": "Protesters outside police station with gunshots heard in Marvdasht", "desc_fa": "تجمع معترضان مقابل کلانتری و صدای تیراندازی در مرودشت", "coords": [29.880899, 52.808695], "link": "https://x.com/Shayan86/status/2007166728086925314", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 25, "verified": true, "desc": "Large group marching in central Marvdasht after a protester's death", "desc_fa": "راهپیمایی بزرگ در مرکز مرودشت پس از کشته شدن یک معترض", "coords": [29.878723, 52.806776], "link": "https://x.com/Shayan86/status/2007170005486711268", "date": "2026-01-02", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2007104961411522690" },
                { "id": 26, "verified": true, "desc": "Protesters chant \"death to the dictator\" on Khayyam Boulevard, Qazvin", "desc_fa": "شعار «مرگ بر دیکتاتور» در بلوار خیام قزوین", "coords": [36.280625, 50.009936], "link": "https://x.com/Shayan86/status/2007176433966465290", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 27, "verified": true, "desc": "Protesters chant \"death to the dictator\" in Nazi Abad, south Tehran", "desc_fa": "شعار «مرگ بر دیکتاتور» در نازی‌آباد تهران", "coords": [35.6379206, 51.4049812], "link": "https://x.com/Shayan86/status/2007179679569264953", "date": "2026-01-02", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2007177746196369773, https://x.com/GhonchehAzad/status/2007490386294677543" },
                { "id": 28, "verified": true, "desc": "Large group chanting for Pahlavi dynasty return on Khayyam Boulevard, Qazvin", "desc_fa": "تجمع بزرگ و شعار در حمایت از پهلوی در بلوار خیام قزوین", "coords": [36.277281, 50.009420], "link": "https://x.com/Shayan86/status/2007187120134431022", "date": "2026-01-02", "size": "big", "alt": null },
                { "id": 29, "verified": true, "desc": "Group gathering on Tohid Boulevard, Qom", "desc_fa": "تجمع گروهی در بلوار توحید قم", "coords": [34.6440083, 50.8613519], "link": "https://x.com/Shayan86/status/2007214603500171285", "date": "2026-01-02", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2007130858772427133" },
                { "id": 30, "verified": true, "desc": "Banner of Qasem Soleimani set on fire near Zayande Rud river, Isfahan", "desc_fa": "آتش زدن بنر قاسم سلیمانی نزدیک زاینده‌رود اصفهان", "coords": [32.6436558, 51.6715999], "link": "https://x.com/Shayan86/status/2007343595926499504", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": 31, "verified": true, "desc": "Group chanting \"long live the Shah\" in Tehranpars, east Tehran", "desc_fa": "شعار «جاوید شاه» در تهرانپارس", "coords": [35.742378, 51.534020], "link": "https://x.com/Shayan86/status/2007345605467926884", "date": "2026-01-03", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2007231019070697694, https://x.com/GhonchehAzad/status/2007527025733751180" },
                { "id": 32, "verified": true, "desc": "Group chanting \"death to the entire regime\" near Haft Hoz Square, Narmak, east Tehran", "desc_fa": "شعار «مرگ بر کل نظام» در میدان هفت‌حوض نارمک", "coords": [35.728287, 51.493069], "link": "https://x.com/Shayan86/status/2007404687960768811", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": 33, "verified": true, "desc": "Group gathered in Kazerun, southern Fars Province", "desc_fa": "تجمع در کازرون، استان فارس", "coords": [29.6193901, 51.6542880], "link": "https://x.com/GhonchehAzad/status/2007387252855583080", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": 34, "verified": true, "desc": "Woman holding sign \"I’m not a rioter\" in Tehran", "desc_fa": "زنی با پلاکارد «من اغتشاشگر نیستم» در تهران", "coords": [35.63914, 51.41092], "link": "https://x.com/GhonchehAzad/status/2007497902902636989", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": 35, "verified": true, "desc": "Group chanting “Death to Khamenei” in Ilam, western Iran", "desc_fa": "شعار «مرگ بر خامنه‌ای» در ایلام", "coords": [33.6368095, 46.4218413], "link": "https://x.com/GhonchehAzad/status/2007488952362742103", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": 36, "verified": true, "desc": "Protesters gathered in front of Charsou, Tehran", "desc_fa": "تجمع معترضان مقابل پاساژ چارسو تهران", "coords": [35.69444, 51.41157], "link": "https://x.com/GhonchehAzad/status/2007820355914932569", "date": "2026-01-04", "size": "medium", "alt": null },
                { "id": 37, "verified": true, "desc": "Security officers shooting in western Ilam Province (towards a hospital)", "desc_fa": "تیراندازی نیروهای امنیتی در ایلام (به سمت بیمارستان)", "coords": [33.6368095, 46.4218413], "link": "https://x.com/GhonchehAzad/status/2007917698450423879", "date": "2026-01-04", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2007919876661502077" },
                { "id": 38, "verified": true, "desc": "Security forces firing at protesters outside government complex in Arkavaz, Malekshahi County, Ilam Province (reported 4-8 killed, 30+ injured)", "desc_fa": "تیراندازی نیروهای امنیتی به معترضان مقابل فرمانداری ارکواز ملکشاهی ایلام (گزارش ۴-۸ کشته)", "coords": [33.39237, 46.59871], "link": "https://x.com/Mitch_Ulrich/status/2007667072223064529", "date": "2026-01-04", "size": "big", "alt": "https://x.com/Mitch_Ulrich/status/2007883928263417878" },
                { "id": 39, "verified": true, "desc": "Clashes with security forces at Imam Hussein Square in Shazand, Markazi Province", "desc_fa": "درگیری با نیروهای امنیتی در میدان امام حسین شازند", "coords": [33.93184, 49.40307], "link": "https://x.com/Mitch_Ulrich/status/2007945788392124873", "date": "2026-01-04", "size": "medium", "alt": null },
                { "id": 40, "verified": true, "desc": "Group of protesters singing “Ey Iran” in Sari, Mazandaran Province", "desc_fa": "گروهی از معترضان در حال خواندن سرود «ای ایران» در ساری، استان مازندران", "coords": [36.56332, 53.06009], "link": "https://x.com/GhonchehAzad/status/2008115146837860529", "date": "2026-01-05", "size": "medium", "alt": null },
                { "id": 41, "verified": true, "desc": "Group chanting “Freedom, Freedom, Freedom” in Yasuj, south-western Kohgiluyeh-Boyerahmad Province", "desc_fa": "شعار «آزادی آزادی آزادی» گروهی از معترضان در یاسوج", "coords": [30.66824, 51.58796], "link": "https://x.com/GhonchehAzad/status/2008155320590487813", "date": "2026-01-05", "size": "big", "alt": null },
                { "id": 42, "verified": true, "desc": "Group chanting “Death to Khamenei” and “Death to the Dictator” near Haft Hoz Square, east Tehran", "desc_fa": "شعار «مرگ بر خامنه‌ای» و «مرگ بر دیکتاتور» در نزدیکی میدان هفت حوض، شرق تهران", "coords": [35.73303, 51.49448], "link": "https://x.com/GhonchehAzad/status/2008256556396339598", "date": "2026-01-05", "size": "big", "alt": "https://x.com/cicikhanoom/status/2008202048895062308, https://x.com/GhonchehAzad/status/2008256732133544164, https://x.com/GhonchehAzad/status/2008256823032516967" },
                { "id": 43, "verified": true, "desc": "Group of protesters dispersed in Tehran", "desc_fa": "گروهی از معترضان در تهران پراکنده شدند", "coords": [35.6714683, 51.4222678], "link": "https://x.com/GhonchehAzad/status/2008519726167937275", "date": "2026-01-06", "size": "big", "alt": null },
                { "id": 44, "verified": true, "desc": "Protesters sitting in front of security forces in Tehran’s Grand Bazaar", "desc_fa": "تحصن معترضان مقابل نیروهای امنیتی در بازار بزرگ تهران", "coords": [35.6727692, 51.4214139], "link": "https://x.com/GhonchehAzad/status/2008489783765635162", "date": "2026-01-06", "size": "big", "alt": "https://x.com/Vahid/status/2008519182355492940" },
                { "id": 50, "verified": true, "desc": "Women's protest in Malekshahi with chants \"Death to the IRGC, Death to Khamenei\"", "desc_fa": "اعتراض زنان در ملکشاهی با شعار «مرگ بر سپاه، مرگ بر خامنه‌ای»", "coords": [33.3924, 46.5987], "link": "https://x.com/FSeifikaran/status/2008544165936902493", "date": "2026-01-06", "size": "big", "alt": null }
            ], []);

            // --- Unverified Data ---
            const unverifiedIncidents = useMemo(() => [
                { "id": "u1", "verified": false, "desc": "Protesters marching on Ferdowsi Street near Sar Manouchehri", "desc_fa": "معترضان در حال راهپیمایی در خیابان فردوسی نزدیک سر منوچهری", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2005629230886072346", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": "u2", "verified": false, "desc": "Gathering and protests outside Ghasr shopping center", "desc_fa": "تجمع و اعتراضات خارج از مرکز خرید قصر", "coords": [26.9584, 56.2716], "link": "https://x.com/Vahid/status/2005667136111571200", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": "u3", "verified": false, "desc": "Protests and clashes in Marlik", "desc_fa": "اعتراضات و درگیری‌ها در مارلیک", "coords": [35.6995, 50.9822], "link": "https://x.com/Vahid/status/2005666037942136865", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": "u4", "verified": false, "desc": "Chants of 'We fight, we die, we take back Iran!' and 'Reza Shah, rest in peace!' in protests", "desc_fa": "شعارهای 'می‌جنگیم، می‌میریم، ایران رو پس می‌گیریم!' و 'رضا شاه روحت شاد!' در اعتراضات", "coords": [34.0850, 49.6910], "link": "https://x.com/Vahid/status/2006449186158633432", "date": "2025-12-31", "size": "medium", "alt": null },
                { "id": "u5", "verified": false, "desc": "Student gathering and chants of 'Death to Khamenei' at dorms", "desc_fa": "تجمع دانشجویی و شعارهای 'مرگ بر خامنه‌ای' در خوابگاه‌ها", "coords": [35.8060, 51.3938], "link": "https://x.com/Vahid/status/2006508642191945737", "date": "2026-01-01", "size": "medium", "alt": null },
                { "id": "u6", "verified": false, "desc": "Woman detained by security forces", "desc_fa": "زن توسط نیروهای امنیتی بازداشت شد", "coords": [35.7283, 51.4931], "link": "https://x.com/Vahid/status/2007146339910726125", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": "u7", "verified": false, "desc": "Woman detained by security forces near Old Darayi Street (15 Khordad) towards Soumeh Blvd", "desc_fa": "زن توسط نیروهای امنیتی نزدیک خیابان درایی قدیمی (۱۵ خرداد) به سمت بلوار سومه بازداشت شد", "coords": [36.2133, 58.7958], "link": "https://x.com/Vahid/status/2007193627454517691", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": "u8", "verified": false, "desc": "Chants of 'No pain is just the hijab, you took our lives!'", "desc_fa": "شعارهای 'درد ما فقط حجاب نیست، جان ما را گرفتید!'", "coords": [35.7424, 51.5340], "link": "https://x.com/Vahid/status/2007239451777610050", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u9", "verified": false, "desc": "Protesters sitting in front of security forces, blocking the street", "desc_fa": "معترضان در مقابل نیروهای امنیتی نشسته، خیابان را مسدود کرده‌اند", "coords": [29.5926, 52.5837], "link": "https://x.com/Vahid/status/2007427222697566259", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u10", "verified": false, "desc": "Chants of 'Death to the dictator'", "desc_fa": "شعارهای 'مرگ بر دیکتاتور'", "coords": [35.6379, 51.4050], "link": "https://x.com/Vahid/status/2007487965828915655", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u11", "verified": false, "desc": "Woman with sign 'I'm not a rioter' amid protesters pulling down flags", "desc_fa": "زن با پلاکارد 'من آشوبگر نیستم' در میان معترضان که پرچم‌ها را پایین می‌کشند", "coords": [35.6379, 51.4050], "link": "https://x.com/Vahid/status/2007489750794744143", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u12", "verified": false, "desc": "Chants of 'Death to Khamenei' on Rahnamai Street", "desc_fa": "شعارهای 'مرگ بر خامنه‌ای' در خیابان راهنمایی", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007497928928309468", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u13", "verified": false, "desc": "Chants of 'Death to the dictator' at second square", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' در میدان دوم", "coords": [35.7424, 51.5340], "link": "https://x.com/Vahid/status/2007515360451555718", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u14", "verified": false, "desc": "Chants of 'Death to the dictator' and 'Long live the Shah!'", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' و 'جاوید شاه!'", "coords": [35.7316, 51.4940], "link": "https://x.com/Vahid/status/2007516003002130533", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u15", "verified": false, "desc": "Chants of 'This is the last battle, Pahlavi will return!' amid breaking glass at Bassij base", "desc_fa": "شعارهای 'این آخرین نبرده، پهلوی بر می‌گرده!' در میان شکستن شیشه در پایگاه بسیج", "coords": [35.7283, 51.4931], "link": "https://x.com/Vahid/status/2007521713920057641", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u16", "verified": false, "desc": "Chants of 'Death to the dictator' at Zafarqandi entrance to Baqeri highway", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' در ورودی ظفرقندی به بزرگراه باقری", "coords": [35.7330, 51.4945], "link": "https://x.com/Vahid/status/2007524799812436236", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u17", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [35.7424, 51.5340], "link": "https://x.com/Vahid/status/2007526668122849775", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u18", "verified": false, "desc": "Chants of 'Death to the dictator' amid pulling down signs and blocking road", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' در میان پایین کشیدن علائم و مسدود کردن جاده", "coords": [35.7283, 51.4931], "link": "https://x.com/Vahid/status/2007529249905738016", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u19", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2007532441246818733", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u20", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [37.2682, 49.5891], "link": "https://x.com/Vahid/status/2007533623667495039", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u21", "verified": false, "desc": "Protesters in front of governorate building", "desc_fa": "معترضان در مقابل ساختمان استانداری", "coords": [29.1989, 54.3278], "link": "https://x.com/Vahid/status/2007536991819432354", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u22", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [30.3500, 50.7500], "link": "https://x.com/Vahid/status/2007541186274439265", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u23", "verified": false, "desc": "Chants of 'This is the last battle, Pahlavi will return!' and 'Long live the Shah!'", "desc_fa": "شعارهای 'این آخرین نبرده، پهلوی بر می‌گرده!' و 'جاوید شاه!'", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007545010288214076", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u24", "verified": false, "desc": "Chants of 'This police is the killer itself!'", "desc_fa": "شعارهای 'این پلیس خودش قاتل است!'", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007553960912277782", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u25", "verified": false, "desc": "Chants of 'Until the mullah is buried, this homeland won't be a homeland!'", "desc_fa": "شعارهای 'تا آخوند کفن نشه این وطن وطن نشه!'", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007557144397406306", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u26", "verified": false, "desc": "Security forces attacking protesters in hospital", "desc_fa": "نیروهای امنیتی به معترضان در بیمارستان حمله می‌کنند", "coords": [33.6384, 46.4226], "link": "https://x.com/Vahid/status/2007917006776094736", "date": "2026-01-04", "size": "small", "alt": null },
                { "id": "u27", "verified": false, "desc": "Security forces firing tear gas at protesters", "desc_fa": "نیروهای امنیتی گاز اشک‌آور به سمت معترضان شلیک می‌کنند", "coords": [32.6539, 51.6660], "link": "https://x.com/Vahid/status/2008240478656098516", "date": "2026-01-05", "size": "medium", "alt": null },
                { "id": "u28", "verified": false, "desc": "Graffiti on overpass: 'Until the mullah is buried, this homeland won't be a homeland!'", "desc_fa": "گرافیتی روی پل هوایی: 'تا آخوند کفن نشه این وطن وطن نشه!'", "coords": [35.7600, 51.4300], "link": "https://x.com/Vahid/status/2008328901148205280", "date": "2026-01-05", "size": "small", "alt": null },
                { "id": "u29", "verified": false, "desc": "Elderly man beaten with baton", "desc_fa": "پیرمرد با باتوم مورد ضرب و شتم قرار گرفت", "coords": [32.3256, 50.8644], "link": "https://x.com/Vahid/status/2008488616671285415", "date": "2026-01-06", "size": "small", "alt": null },
                { "id": "u30", "verified": false, "desc": "Tear gas fired on Saadi Street", "desc_fa": "شلیک گاز اشک‌آور در خیابان سعدی", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2008496505364377703", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u31", "verified": false, "desc": "Chants of 'Long live the Shah!' and 'Death to the dictator!' in Hamam Chal Alley", "desc_fa": "شعارهای 'جاوید شاه!' و 'مرگ بر دیکتاتور!' در کوچه حمام چال", "coords": [35.6728, 51.4214], "link": "https://x.com/Vahid/status/2008503951281586479", "date": "2026-01-06", "size": "small", "alt": null },
                { "id": "u32", "verified": false, "desc": "Agents closed hospital door with gunshots heard", "desc_fa": "مأموران درب بیمارستان را بستند و صدای تیراندازی شنیده شد", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2008519182355492940", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u33", "verified": false, "desc": "Gathering on Imam Hossein Square, Mazandaran Street", "desc_fa": "تجمع در میدان امام حسین، خیابان مازندران", "coords": [35.7075, 51.4350], "link": "https://x.com/Vahid/status/2008536730283205067", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u34", "verified": false, "desc": "Protesters hit with paintball guns", "desc_fa": "معترضان هدف گلوله‌های پینت‌بال قرار گرفتند", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2008540439272669508", "date": "2026-01-06", "size": "small", "alt": null },
                { "id": "u35", "verified": false, "desc": "Protests underway", "desc_fa": "اعتراضات در جریان است", "coords": [32.6539, 51.6660], "link": "https://x.com/FaytuksNetwork/status/2006785806715990341", "date": "2026-01-01", "size": "small", "alt": null },
                { "id": "u36", "verified": false, "desc": "Protesters blocked street and chanted", "desc_fa": "معترضان خیابان را بستند و شعار دادند", "coords": [36.2806, 50.0099], "link": "https://x.com/FaytuksNetwork/status/2007262733633499197", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u37", "verified": false, "desc": "Protesters confirmed", "desc_fa": "حضور معترضان تایید شد", "coords": [35.7424, 51.5340], "link": "https://x.com/FaytuksNetwork/status/2007105753560019118", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": "u38", "verified": false, "desc": "Protesters stand ground in front of water cannon", "desc_fa": "ایستادگی معترضان در برابر ماشین آب‌پاش", "coords": [34.7955, 48.5144], "link": "https://x.com/FaytuksNetwork/status/2007042104959402413", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": "u39", "verified": false, "desc": "Protesters set fire to statue", "desc_fa": "آتش زدن مجسمه توسط معترضان", "coords": [32.3343, 49.0914], "link": "https://x.com/FaytuksNetwork/status/2006826834193961402", "date": "2026-01-01", "size": "medium", "alt": null },
                { "id": "u40", "verified": false, "desc": "Protests continue", "desc_fa": "ادامه اعتراضات", "coords": [33.5634, 46.5658], "link": "https://x.com/FaytuksNetwork/status/2007249260778270776", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u41", "verified": false, "desc": "Security forces in front of hospital with screams heard", "desc_fa": "نیروهای امنیتی مقابل بیمارستان و صدای فریاد", "coords": [33.6370, 46.4208], "link": "https://x.com/FaytuksNetwork/status/2007916014546346316", "date": "2026-01-04", "size": "small", "alt": null },
                { "id": "u42", "verified": false, "desc": "Protesters breaking into a bank", "desc_fa": "شکستن شیشه‌های بانک توسط معترضان", "coords": [33.3851, 46.6002], "link": "https://x.com/FaytuksNetwork/status/2008568012694253582", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u43", "verified": false, "desc": "Protesters in the city", "desc_fa": "حضور معترضان در سطح شهر", "coords": [33.3850, 46.5999], "link": "https://x.com/FaytuksNetwork/status/2008565817659761115", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u44", "verified": false, "desc": "Tear gas was fired into the entrance of hospital", "desc_fa": "شلیک گاز اشک‌آور به ورودی بیمارستان", "coords": [35.6863, 51.4121], "link": "https://x.com/FaytuksNetwork/status/2008531821819212145", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u45", "verified": false, "desc": "Video shows police waving at demonstrators", "desc_fa": "ویدیو نشان می‌دهد پلیس برای تظاهرکنندگان دست تکان می‌دهد", "coords": [32.9927, 47.4198], "link": "https://x.com/FaytuksNetwork/status/2008576732308418982", "date": "2026-01-06", "size": "small", "alt": "https://x.com/FaytuksNetwork/status/2008588742257430636" }
            ], []);

            const allIncidents = useMemo(() => {
                const combined = showUnverified ? [...verifiedIncidents, ...unverifiedIncidents] : verifiedIncidents;
                return combined.map(i => ({
                    ...i,
                    link: i.link.replace(/^\[|\]\(.*?\)$/g, '').replace(/\)$/, ''),
                    alt: i.alt ? i.alt.replace(/^\[|\]\(.*?\)$/g, '').replace(/\)$/, '').split(',')[0].trim() : null
                }));
            }, [verifiedIncidents, unverifiedIncidents, showUnverified]);

            // --- Timeline Data ---
            const { uniqueDates, minDate, maxDate } = useMemo(() => {
                const dates = [...new Set(allIncidents.map(i => i.date))].sort();
                return { uniqueDates: dates, minDate: dates[0], maxDate: dates[dates.length - 1] };
            }, [allIncidents]);

            // Filter logic
            const displayedIncidents = useMemo(() => {
                if (!dateFilter) return allIncidents;
                return allIncidents.filter(i => i.date === dateFilter);
            }, [allIncidents, dateFilter]);

            // Playback logic
            useEffect(() => {
                let interval;
                if (isPlaying && uniqueDates.length > 0) {
                    interval = setInterval(() => {
                        setDateFilter(currentDate => {
                            if (!currentDate) return uniqueDates[0];
                            const currentIndex = uniqueDates.indexOf(currentDate);
                            if (currentIndex < uniqueDates.length - 1) {
                                return uniqueDates[currentIndex + 1];
                            } else {
                                setIsPlaying(false);
                                return currentDate;
                            }
                        });
                    }, 1500);
                }
                return () => clearInterval(interval);
            }, [isPlaying, uniqueDates]);

            // --- Configuration ---
            const layers = {
                light: { name: 'Light', url: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png' },
                dark: { name: 'Dark', url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png' },
                satellite: { name: 'Satellite', url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}' }
            };

            // --- Map Initialization ---
            useEffect(() => {
                if (!mapContainerRef.current || mapInstanceRef.current) return;
                if (!window.L) {
                    const checkL = setInterval(() => { if (window.L) { clearInterval(checkL); setIsMapReady(true); } }, 100);
                    return;
                } else { setIsMapReady(true); }

                const L = window.L;
                const iranCenter = [32.4279, 53.6880];
                const iranBounds = [[24.5, 43.5], [40.0, 64.0]];

                const map = L.map(mapContainerRef.current, {
                    center: iranCenter,
                    zoom: 5,
                    minZoom: 5,
                    maxZoom: 18,
                    zoomControl: false,
                    maxBounds: iranBounds,
                    maxBoundsViscosity: 1.0,
                });

                tileLayerRef.current = L.tileLayer(layers.light.url, { subdomains: 'abcd', maxZoom: 20 }).addTo(map);
                mapInstanceRef.current = map;
                map.on('zoomend', () => setZoomLevel(map.getZoom()));
                setTimeout(() => map.invalidateSize(), 100);
            }, [isMapReady]);

            // --- Handle Markers ---
            useEffect(() => {
                if (!mapInstanceRef.current || !window.L) return;
                const L = window.L;
                const map = mapInstanceRef.current;

                markersRef.current.forEach(marker => marker.remove());
                markersRef.current = [];

                const getColor = (incident) => {
                    if (!incident.verified) return '#9CA3AF'; // Grey-400 for unverified
                    switch (incident.size) {
                        case 'big': return '#EF4444';
                        case 'medium': return '#F97316';
                        default: return '#FACC15'; 
                    }
                };
                const getScale = (size) => {
                    switch (size) {
                        case 'big': return 48;
                        case 'medium': return 40;
                        default: return 32;
                    }
                };

                displayedIncidents.forEach(incident => {
                    const color = getColor(incident);
                    const iconSize = getScale(incident.size);
                    const iconHtml = `
                        <div class="relative group flex items-center justify-center transition-transform hover:scale-110 duration-200" style="width: ${iconSize}px; height: ${iconSize}px;">
                            <svg width="${iconSize}" height="${iconSize}" viewBox="0 0 24 24" fill="${color}" style="filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.2)); display: block; opacity: 0.8;">
                                <circle cx="12" cy="12" r="10" />
                            </svg>
                        </div>
                    `;
                    const customIcon = L.divIcon({
                        html: iconHtml,
                        className: 'bg-transparent border-none',
                        iconSize: [iconSize, iconSize],
                        iconAnchor: [iconSize / 2, iconSize],
                        popupAnchor: [0, -iconSize]
                    });

                    const marker = L.marker(incident.coords, { icon: customIcon })
                        .addTo(map)
                        .bindTooltip(`
                            <div class="font-sans text-sm font-semibold px-1 ${lang === 'fa' ? 'text-right' : 'text-center'}" dir="${lang === 'fa' ? 'rtl' : 'ltr'}">
                                <div>
                                    ${lang === 'fa' && incident.desc_fa ? incident.desc_fa : incident.desc}
                                </div>
                                <div class="text-xs text-gray-500 font-normal mt-1 opacity-70">${t.clickForInfo}</div>
                            </div>
                        `, { direction: 'top', offset: [0, -iconSize + 5], opacity: 0.95, className: 'custom-tooltip' });

                    marker.on('click', () => {
                        setSelectedIncident(incident);
                        map.flyTo(incident.coords, 14, { duration: 1.5 });
                    });

                    markersRef.current.push(marker);
                });
            }, [isMapReady, displayedIncidents, lang]);

            // --- Handle Layer Switching ---
            useEffect(() => {
                if (!mapInstanceRef.current || !window.L) return;
                if (tileLayerRef.current) mapInstanceRef.current.removeLayer(tileLayerRef.current);
                tileLayerRef.current = window.L.tileLayer(layers[activeLayer].url, { subdomains: 'abcd', maxZoom: 20 }).addTo(mapInstanceRef.current);
            }, [activeLayer]);

            // --- Helpers ---
            const handleZoomIn = () => mapInstanceRef.current?.zoomIn();
            const handleZoomOut = () => mapInstanceRef.current?.zoomOut();
            const closeModal = () => setSelectedIncident(null);

            const toggleTheme = () => {
                if (activeLayer === 'light') setActiveLayer('dark');
                else setActiveLayer('light');
            };
            const toggleSatellite = () => {
                if (activeLayer === 'satellite') setActiveLayer('light');
                else setActiveLayer('satellite');
            };
            const toggleLang = () => {
                setLang(prev => prev === 'en' ? 'fa' : 'en');
            };

            const resetView = () => {
                if (mapInstanceRef.current) {
                    mapInstanceRef.current.flyTo([32.4279, 53.6880], 5, { duration: 1.5 });
                    setSelectedIncident(null);
                    setShowGraph(false);
                }
            };

            const glassClass = isDarkMode ? "bg-gray-900/60 border-gray-700/50 text-white" : "bg-white/60 border-white/40 text-gray-700";
            const glassHover = isDarkMode ? "hover:bg-gray-800/80" : "hover:bg-white/80";

            return (
                <div className="relative w-full h-screen bg-gray-100 overflow-hidden font-sans" dir={lang === 'fa' ? 'rtl' : 'ltr'}>
                    
                    <div ref={mapContainerRef} className="absolute inset-0 z-0 bg-slate-200" />

                    {/* Header */}
                    <div className={`absolute top-4 md:top-6 z-[1000] select-none max-w-[60%] md:max-w-[80vw] group ${lang === 'fa' ? 'right-4 md:right-6 text-right' : 'left-4 md:left-6 text-left'}`}>
                        <h1 
                            onClick={resetView}
                            className={`text-xl md:text-3xl lg:text-4xl font-extrabold tracking-tight drop-shadow-lg transition-all duration-300 cursor-pointer active:scale-95 group-hover:opacity-80 ${isDarkMode ? 'text-white' : 'text-gray-900'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}
                            title={t.title}
                        >
                            {t.title}
                        </h1>
                        <p className={`text-xs md:text-sm font-medium mt-1 drop-shadow-md transition-colors duration-300 ${isDarkMode ? 'text-gray-200' : 'text-gray-600'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                            {t.subtitle.replace('{count}', displayedIncidents.length)}
                        </p>
                        
                        {/* Legend */}
                        <div className={`mt-2 md:mt-3 flex flex-col space-y-1.5 transition-colors duration-300 ${isDarkMode ? 'text-gray-200' : 'text-gray-600'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                            <div className="flex items-center text-xs font-medium drop-shadow-md">
                                <span className={`w-2.5 h-2.5 rounded-full bg-red-500 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                {t.largeCrowd}
                            </div>
                            <div className="flex items-center text-xs font-medium drop-shadow-md">
                                <span className={`w-2.5 h-2.5 rounded-full bg-orange-500 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                {t.mediumCrowd}
                            </div>
                            <div className="flex items-center text-xs font-medium drop-shadow-md">
                                <span className={`w-2.5 h-2.5 rounded-full bg-yellow-400 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                {t.smallGroup}
                            </div>
                            {/* Unverified Legend Item */}
                            {showUnverified && (
                                <div className="flex items-center text-xs font-medium drop-shadow-md animate-fade-in">
                                    <span className={`w-2.5 h-2.5 rounded-full bg-gray-400 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                    {t.unverified}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Top Controls (Buttons) */}
                    <div className={`absolute top-4 md:top-6 z-[1000] flex flex-col space-y-2 md:space-y-3 items-end ${lang === 'fa' ? 'left-4 md:left-6' : 'right-4 md:right-6'}`}>
                        <div className={`backdrop-blur-xl shadow-xl rounded-full p-1 md:p-1.5 border flex items-center space-x-2 transition-colors duration-300 ${glassClass} ${lang === 'fa' ? 'space-x-reverse' : ''}`}>
                            <button onClick={toggleTheme} className={`p-1.5 md:p-2.5 rounded-full transition-all duration-200 ${glassHover}`} title="Toggle Light/Dark">
                                {activeLayer === 'light' ? <IconSun className="w-4 h-4 md:w-5 md:h-5" /> : <IconMoon className="w-4 h-4 md:w-5 md:h-5" />}
                            </button>
                            <button onClick={toggleSatellite} className={`p-1.5 md:p-2.5 rounded-full transition-all duration-200 text-sm md:text-lg leading-none ${activeLayer === 'satellite' ? 'bg-blue-600/80 text-white' : glassHover}`} title="Satellite View">
                                🛰️
                            </button>
                            <button onClick={toggleLang} className={`p-1.5 md:p-2.5 rounded-full transition-all duration-200 font-bold text-xs ${glassHover}`} title="Switch Language">
                                {lang === 'en' ? <span className="font-[Vazirmatn] text-[10px] md:text-xs">فارسی</span> : 'EN'}
                            </button>
                        </div>

                        <button 
                            onClick={() => setShowGraph(true)} 
                            className={`backdrop-blur-xl shadow-xl rounded-full px-3 py-1.5 md:px-4 md:py-2 border flex items-center space-x-2 text-xs md:text-sm font-semibold transition-all duration-200 ${glassClass} ${glassHover} ${lang === 'fa' ? 'space-x-reverse font-[Vazirmatn]' : ''}`}
                        >
                            <IconChart className="w-4 h-4 md:w-5 md:h-5" />
                            <span>{t.showChart}</span>
                        </button>

                         <button 
                            onClick={() => setShowUnverified(!showUnverified)} 
                            className={`backdrop-blur-xl shadow-xl rounded-full px-3 py-1.5 md:px-4 md:py-2 border flex items-center space-x-2 text-xs md:text-sm font-semibold transition-all duration-200 ${glassClass} ${glassHover} ${lang === 'fa' ? 'space-x-reverse font-[Vazirmatn]' : ''}`}
                        >
                            <IconAlert className="w-4 h-4 md:w-5 md:h-5" />
                            <span>{showUnverified ? t.hideUnverified : t.showUnverified}</span>
                        </button>
                    </div>

                    {/* Timeline Slider (Bottom Center) */}
                    <div className="absolute bottom-8 left-1/2 -translate-x-1/2 z-[1000] w-full max-w-xl px-4">
                         <div className={`backdrop-blur-xl shadow-2xl rounded-2xl p-3 md:p-4 border flex flex-col space-y-3 transition-colors duration-300 timeline-flag-glass ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                            <div className={`flex justify-between items-center text-xs font-bold uppercase tracking-wide opacity-90 ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>
                                <span>{t.timeline}</span>
                                <span>{dateFilter || t.showingAll}</span>
                            </div>
                            
                            <div className={`flex items-center space-x-4 ${lang === 'fa' ? 'space-x-reverse' : ''}`}>
                                <button 
                                    onClick={() => setIsPlaying(!isPlaying)}
                                    className={`p-2 rounded-full transition-colors ${isPlaying ? 'bg-gray-700 text-white' : 'bg-gray-900 text-white hover:bg-gray-700'}`}
                                    title={isPlaying ? "Pause" : "Play Timeline"}
                                >
                                    {isPlaying ? <IconPause className="w-4 h-4" /> : <IconPlay className="w-4 h-4" />}
                                </button>

                                <div className="flex-1 relative flex items-center">
                                    <input 
                                        type="range" 
                                        min="0" 
                                        max={uniqueDates.length - 1} 
                                        value={dateFilter ? uniqueDates.indexOf(dateFilter) : 0} 
                                        onChange={(e) => {
                                            setIsPlaying(false); 
                                            setDateFilter(uniqueDates[e.target.value]);
                                        }}
                                        disabled={!dateFilter && isPlaying}
                                        className={`w-full h-2 bg-gray-500/30 rounded-lg appearance-none cursor-pointer z-10 ${lang === 'fa' ? 'rotate-180' : ''}`}
                                    />
                                    <div className="absolute inset-0 h-2 bg-gray-500/20 rounded-lg -z-0 pointer-events-none"></div>
                                </div>

                                <button 
                                    onClick={() => { setIsPlaying(false); setDateFilter(null); }} 
                                    className={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-colors border ${!dateFilter ? 'bg-gray-800 border-gray-800 text-white' : 'border-gray-600 text-gray-700 hover:bg-gray-800 hover:text-white'}`}
                                >
                                    {t.all}
                                </button>
                            </div>
                         </div>
                    </div>

                    {/* Graph Modal */}
                    {showGraph && <ProtestGraph data={allIncidents} onClose={() => setShowGraph(false)} isDarkMode={isDarkMode} t={t} lang={lang} />}

                    {/* Details Panel */}
                    {selectedIncident && (
                        <div className={`absolute inset-0 z-[2000] flex pointer-events-none ${lang === 'fa' ? 'justify-start' : 'justify-end'}`}>
                            <div className={`relative w-full max-w-md h-full backdrop-blur-xl shadow-2xl border-l overflow-y-auto flex flex-col no-scrollbar pointer-events-auto ${lang === 'fa' ? 'animate-slide-in-left border-r' : 'animate-slide-in-right border-l'} ${isDarkMode ? 'bg-gray-900/80 border-gray-700/50' : 'bg-white/80 border-white/50'}`} dir={lang === 'fa' ? 'rtl' : 'ltr'}>
                                <div className={`sticky top-0 z-10 px-6 py-4 border-b flex justify-between items-start backdrop-blur-md ${isDarkMode ? 'bg-gray-900/60 border-gray-800' : 'bg-white/60 border-gray-100'}`}>
                                    <div>
                                        <h2 className={`text-xl font-bold leading-tight ${isDarkMode ? 'text-white' : 'text-gray-900'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>{t.incidentDetails}</h2>
                                    </div>
                                    <button onClick={closeModal} className={`p-2 rounded-full transition-colors ${isDarkMode ? 'hover:bg-gray-800 text-gray-400' : 'hover:bg-gray-100 text-gray-500'}`}>
                                        <IconX className="w-5 h-5" />
                                    </button>
                                </div>

                                <div className={`p-6 space-y-6 ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className={`p-3 rounded-xl border ${isDarkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50/50 border-gray-100'}`}>
                                            <div className={`flex items-center text-gray-500 mb-1 text-xs uppercase tracking-wide font-bold`}>
                                                <IconCalendar className={`w-4 h-4 ${lang === 'fa' ? 'ml-1.5' : 'mr-1.5'}`} /> 
                                                {t.date}
                                            </div>
                                            <div className={`font-semibold ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>{selectedIncident.date}</div>
                                            <div className="mt-1 text-[10px] text-gray-400 italic leading-tight">{t.dateNote}</div>
                                        </div>
                                        <div className={`p-3 rounded-xl border ${isDarkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50/50 border-gray-100'}`}>
                                            <div className={`flex items-center text-gray-500 mb-1 text-xs uppercase tracking-wide font-bold`}>
                                                <IconMapPin className={`w-4 h-4 ${lang === 'fa' ? 'ml-1.5' : 'mr-1.5'}`} /> 
                                                {t.location}
                                            </div>
                                            <div className={`font-mono text-sm font-semibold ${isDarkMode ? 'text-gray-200' : 'text-gray-800'} ${lang === 'fa' ? 'text-left' : ''} text-left`} dir="ltr">
                                                {selectedIncident.coords[0].toFixed(3)}, {selectedIncident.coords[1].toFixed(3)}
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className={`text-sm font-bold uppercase tracking-wide mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-900'}`}>{t.description}</h3>
                                        <p className={`leading-relaxed p-4 rounded-xl border ${isDarkMode ? 'bg-blue-900/10 border-blue-800 text-gray-300' : 'bg-blue-50/30 border-blue-100 text-gray-700'}`}>
                                            {lang === 'fa' && selectedIncident.desc_fa ? selectedIncident.desc_fa : selectedIncident.desc}
                                        </p>
                                    </div>

                                    <div className="space-y-6">
                                        <div>
                                            <div className="flex items-center justify-between mb-3">
                                                <h3 className={`text-sm font-bold uppercase tracking-wide ${isDarkMode ? 'text-gray-300' : 'text-gray-900'}`}>{t.footage}</h3>
                                                <a href={selectedIncident.link} target="_blank" rel="noreferrer" className="text-xs text-blue-500 hover:underline flex items-center">
                                                    {t.viewOnX} <IconExternalLink className="w-3 h-3 ml-1" />
                                                </a>
                                            </div>
                                            <TweetEmbed url={selectedIncident.link} isDarkMode={isDarkMode} />
                                        </div>
                                        {selectedIncident.alt && (
                                            <div>
                                                <div className="flex items-center justify-between mb-3">
                                                    <h3 className={`text-sm font-bold uppercase tracking-wide ${isDarkMode ? 'text-gray-300' : 'text-gray-900'}`}>{t.altAngle}</h3>
                                                    <a href={selectedIncident.alt} target="_blank" rel="noreferrer" className="text-xs text-blue-500 hover:underline flex items-center">
                                                        {t.viewOnX} <IconExternalLink className="w-3 h-3 ml-1" />
                                                    </a>
                                                </div>
                                                <TweetEmbed url={selectedIncident.alt} isDarkMode={isDarkMode} />
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<IranMap />);
    </script>
</body>
</html>
