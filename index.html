<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Added viewport-fit=cover for iPhone X+ notch/home bar support and user-scalable=no to prevent accidental UI zooming -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Iran Protest Map</title>
    <link rel="icon" type="image/jpeg" href="./Iran.jpg">
    <link rel="apple-touch-icon" href="./Iran.jpg">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Google Fonts for Farsi -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* CRITICAL FIX for Leaflet in RTL mode */
        .leaflet-container {
            direction: ltr !important; 
            background: #cbd5e1; /* slate-300 fallback */
        }

        /* Prevent pull-to-refresh on mobile */
        body {
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Safe Area Utilities for iOS */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .mb-safe { margin-bottom: env(safe-area-inset-bottom); }
        .pt-safe { padding-top: env(safe-area-inset-top); }
        .top-safe { top: env(safe-area-inset-top); }

        /* Animations */
        @keyframes slide-in-right {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-in-left {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Responsive Animation Classes */
        .animate-panel-desktop-ltr { animation: slide-in-right 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-panel-desktop-rtl { animation: slide-in-left 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        /* Mobile panel animation handled by JS/Drag now, initial slide up only */
        .animate-panel-mobile-enter { animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1); }

        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fade-in 0.2s ease-out;
        }

        /* Custom Loading Spinner */
        @keyframes spin-slow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .iran-loader {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: #22c55e; /* Green */
            border-bottom-color: #ef4444; /* Red */
            border-left-color: #22c55e; /* Green */
            border-right-color: #ef4444; /* Red */
            animation: spin-slow 1.5s linear infinite;
            position: relative;
        }
        .iran-loader::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }

        /* Flag Stained Glass Theme for Timeline */
        .timeline-flag-glass {
            background: linear-gradient(
                180deg, 
                rgba(34, 197, 94, 0.15) 0%, 
                rgba(255, 255, 255, 0.5) 45%, 
                rgba(255, 255, 255, 0.5) 55%, 
                rgba(239, 68, 68, 0.15) 100%
            );
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-theme .timeline-flag-glass {
             background: linear-gradient(
                180deg, 
                rgba(34, 197, 94, 0.15) 0%, 
                rgba(255, 255, 255, 0.1) 45%, 
                rgba(255, 255, 255, 0.1) 55%, 
                rgba(239, 68, 68, 0.15) 100%
            );
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* Leaflet Tooltip Customization */
        .leaflet-tooltip-pane .custom-tooltip {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            color: #1f2937;
            padding: 8px 12px;
            width: max-content;
            max-width: min(300px, 80vw); /* Reduced max-width for mobile */
            white-space: normal;
            text-align: center;
            line-height: 1.4;
            transition: all 0.3s ease;
            pointer-events: none; /* Let touches pass through to map */
        }
        .leaflet-tooltip-pane .custom-tooltip::before {
            border-top-color: rgba(255, 255, 255, 0.95);
        }

        /* Dark Mode Tooltip Overrides */
        body.dark-theme .leaflet-tooltip-pane .custom-tooltip {
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #f3f4f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }
        body.dark-theme .leaflet-tooltip-pane .custom-tooltip::before {
            border-top-color: rgba(17, 24, 39, 0.95);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Slider Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; background: #4b5563; cursor: pointer; margin-top: -10px; box-shadow: 0 0 2px rgba(0,0,0,0.5); transition: transform 0.1s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: rgba(156, 163, 175, 0.5); border-radius: 2px; }
        input[type=range]:focus { outline: none; }
        
        /* Mobile Specific Adjustments */
        @media (max-width: 768px) {
            .leaflet-control-container .leaflet-top { top: 60px; } 
        }
    </style>
</head>
<body class="bg-gray-100 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- Icons ---
        const IconSun = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>;
        const IconMoon = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>;
        const IconChart = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>;
        const IconPlay = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const IconPause = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>;
        const IconAlert = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>;
        const IconX = ({ className = "w-5 h-5" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const IconCalendar = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const IconMapPin = ({ className = "w-4 h-4" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>;
        const IconExternalLink = ({ className = "w-3 h-3" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>;

        const translations = {
            en: {
                title: "Iran Protest Map",
                subtitle: "Verified Incident Tracker • {count} Events Visible",
                tapToZoomOut: "Tap here to zoom out",
                largeCrowd: "Large Crowd",
                mediumCrowd: "Medium Crowd",
                smallGroup: "Small Crowd",
                unverified: "Unverified",
                showChart: "Show Chart",
                showUnverified: "Show Unverified",
                hideUnverified: "Hide Unverified",
                timeline: "Timeline Control",
                showingAll: "Showing All Events",
                all: "All",
                chartTitle: "Protest Activity Over Time",
                chartNote: "Note: Date reflects date of tweet, not necessarily the date of the incident. Verified totals for the most recent day may appear lower while new footage is still being confirmed.",
                total: "Total",
                large: "Large Crowd",
                medium: "Medium Crowd",
                small: "Small Crowd",
                yAxisLabel: "Number of Protest Incidents",
                incidentDetails: "Incident Details",
                date: "Date",
                dateNote: "Date reflects tweet date.",
                location: "Location",
                description: "Description",
                footage: "Footage",
                altAngle: "Alt Angle",
                viewOnX: "View on X",
                clickForInfo: "Click for more info"
            },
            fa: {
                title: "نقشه اعتراضات ایران",
                subtitle: "ردیاب حوادث تایید شده • {count} رویداد قابل مشاهده",
                tapToZoomOut: "برای کوچک‌نمایی ضربه بزنید",
                largeCrowd: "جمعیت زیاد",
                mediumCrowd: "جمعیت متوسط",
                smallGroup: "جمعیت کم",
                unverified: "تأیید نشده",
                showChart: "نمایش نمودار",
                showUnverified: "نمایش تأیید نشده",
                hideUnverified: "پنهان کردن تأیید نشده",
                timeline: "کنترل زمانی",
                showingAll: "نمایش همه رویدادها",
                all: "همه",
                chartTitle: "فعالیت اعتراضات در طول زمان",
                chartNote: "توجه: تاریخ منعکس کننده تاریخ توییت است، نه لزوماً تاریخ حادثه. ممکن است مجموع تأییدشده برای جدیدترین روز کمتر به نظر برسد چون تأیید ویدیوهای تازه هنوز ادامه دارد.",
                total: "کل",
                large: "جمعیت زیاد",
                medium: "جمعیت متوسط",
                small: "جمعیت کم",
                yAxisLabel: "تعداد رخدادهای اعتراضی",
                incidentDetails: "جزئیات حادثه",
                date: "تاریخ",
                dateNote: "تاریخ منعکس کننده تاریخ توییت است.",
                location: "مکان",
                description: "توضیحات",
                footage: "ویدیو",
                altAngle: "زاویه دیگر",
                viewOnX: "مشاهده در X",
                clickForInfo: "برای اطلاعات بیشتر کلیک کنید"
            }
        };

        const formatDateWithWeekday = (dateString) => {
            if (!dateString) return '';
            return dateString;
        };

        const TweetEmbed = ({ url, isDarkMode }) => {
            const containerRef = useRef(null);
            const [isLoading, setIsLoading] = useState(true);
            const theme = isDarkMode ? 'dark' : 'light';

            useEffect(() => {
                if (!url || !containerRef.current) return;
                setIsLoading(true);
                const cleanUrl = url.split(',')[0].trim();
                const tweetId = cleanUrl.split('/').pop().split('?')[0];
                containerRef.current.innerHTML = ''; 

                const renderTweet = () => {
                    if (window.twttr && window.twttr.widgets) {
                        window.twttr.widgets.createTweet(
                            tweetId,
                            containerRef.current,
                            { theme: theme, conversation: 'none', align: 'center' }
                        ).then(() => {
                            setIsLoading(false);
                        });
                    }
                };

                if (window.twttr && window.twttr.widgets) {
                    renderTweet();
                } else {
                    const script = document.createElement('script');
                    script.src = 'https://platform.twitter.com/widgets.js';
                    script.async = true;
                    script.onload = renderTweet;
                    document.body.appendChild(script);
                }
            }, [url, theme]);

            return (
                <div className={`relative rounded-xl overflow-hidden border transition-all duration-300 ${isLoading ? 'min-h-[250px]' : ''} ${isDarkMode ? 'border-gray-700' : 'border-gray-200'} ${isLoading ? (isDarkMode ? 'bg-gray-900' : 'bg-gray-50') : 'bg-transparent border-none'}`}>
                   {isLoading && (
                       <div className="absolute inset-0 flex items-center justify-center z-0">
                           <div className="iran-loader"></div>
                       </div>
                   )}
                   <div ref={containerRef} className="relative z-10 w-full flex items-center justify-center"></div>
                </div>
            );
        };

        const ProtestGraph = ({ data, onClose, isDarkMode, t, lang, showUnverified, onToggleUnverified }) => {
            const processedData = useMemo(() => {
                const dates = [...new Set(data.map(d => d.date))].sort();
                const series = dates.map(date => {
                    const dayEvents = data.filter(d => d.date === date);
                    return {
                        date,
                        total: dayEvents.length,
                        small: dayEvents.filter(d => d.size === 'small' && d.verified).length,
                        medium: dayEvents.filter(d => d.size === 'medium' && d.verified).length,
                        big: dayEvents.filter(d => d.size === 'big' && d.verified).length,
                        unverified: dayEvents.filter(d => !d.verified).length
                    };
                });
                return { dates, series };
            }, [data]);

            const { dates, series } = processedData;
            const isCompact = window.innerWidth < 640;
            const height = isCompact ? 240 : 320;
            const width = isCompact ? 560 : 820;
            const padding = isCompact ? 52 : 72;
            const graphWidth = width - padding * 2;
            const graphHeight = height - padding * 2;
            const maxVal = Math.max(...series.map(s => s.total), 5); 
            const getX = (index) => padding + (index / (dates.length - 1)) * graphWidth;
            const getY = (val) => height - padding - (val / maxVal) * graphHeight;
            const yTicks = [0, 0.25, 0.5, 0.75, 1];
            const createPath = (key) => {
                if (series.length === 0) return "";
                return "M" + series.map((p, i) => `${getX(i)},${getY(p[key])}`).join(" L");
            };

            const textColor = isDarkMode ? "text-gray-200" : "text-gray-600";
            const bgColor = isDarkMode ? "bg-gray-900/95 border-gray-700" : "bg-white/95 border-white/20";

            return (
                <div className="fixed inset-0 z-[2001] flex items-center justify-center p-4 pb-safe" dir={lang === 'fa' ? 'rtl' : 'ltr'}>
                     <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
                     <div className={`relative ${bgColor} backdrop-blur-xl border shadow-2xl rounded-3xl p-5 md:p-8 w-full max-w-5xl animate-fade-in`}>
                        <div className="flex flex-wrap justify-between items-start gap-4 mb-6">
                            <div>
                                <h2 className={`text-xl md:text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>{t.chartTitle}</h2>
                                <p className={`text-xs md:text-sm text-gray-400 italic mt-2 ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>{t.chartNote}</p>
                                <div className={`mt-3 flex flex-wrap items-center gap-2 ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                                    <button
                                        onClick={onToggleUnverified}
                                        className={`px-3.5 py-2 rounded-full border text-xs md:text-sm font-semibold transition-all duration-200 active:scale-95 ${isDarkMode ? 'bg-gray-800/70 border-gray-600 text-gray-200 hover:bg-gray-700/80' : 'bg-white/80 border-gray-200 text-gray-700 hover:bg-white'}`}
                                    >
                                        <span className="flex items-center gap-2">
                                            <IconAlert className="w-4 h-4 md:w-5 md:h-5" />
                                            <span>{showUnverified ? t.hideUnverified : t.showUnverified}</span>
                                        </span>
                                    </button>
                                </div>
                                <div className={`mt-4 flex flex-wrap items-center gap-x-5 gap-y-3 text-xs md:text-sm font-semibold ${textColor} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                                    <div className="flex items-center gap-2">
                                        <span className="w-8 border-t-2 border-blue-400"></span>
                                        <span>{t.total}</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="w-8 border-t-2 border-dashed border-red-500"></span>
                                        <span>{t.large}</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="w-8 border-t-2 border-dashed border-orange-500"></span>
                                        <span>{t.medium}</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="w-8 border-t-2 border-yellow-400"></span>
                                        <span>{t.small}</span>
                                    </div>
                                    {showUnverified && (
                                        <div className="flex items-center gap-2">
                                            <span className="w-8 border-t-2 border-dotted border-gray-400"></span>
                                            <span>{t.unverified}</span>
                                        </div>
                                    )}
                                </div>
                            </div>
                            <button onClick={onClose} className={`p-2.5 rounded-full transition-colors ${isDarkMode ? 'hover:bg-gray-800 text-gray-400' : 'hover:bg-gray-100 text-gray-500'}`}><IconX className="w-6 h-6 md:w-7 md:h-7" /></button>
                        </div>
                        <div className="overflow-x-auto no-scrollbar" dir="ltr"> 
                            <svg width="100%" height={height} viewBox={`0 0 ${width} ${height}`} className="overflow-visible min-w-[340px]">
                                <line x1={padding} y1={padding} x2={padding} y2={height - padding} stroke={isDarkMode ? "#4B5563" : "#d1d5db"} />
                                <line x1={padding} y1={height - padding} x2={width - padding} y2={height - padding} stroke={isDarkMode ? "#4B5563" : "#d1d5db"} />
                                {yTicks.map((tick) => {
                                    const value = Math.round(tick * maxVal);
                                    return (
                                        <g key={tick}>
                                            <line x1={padding} y1={getY(tick * maxVal)} x2={width - padding} y2={getY(tick * maxVal)} stroke={isDarkMode ? "#374151" : "#e5e7eb"} strokeDasharray="4 4" />
                                            <text x={padding - 10} y={getY(tick * maxVal) + 4} fontSize={isCompact ? "9" : "11"} textAnchor="end" fill={isDarkMode ? "#9CA3AF" : "#6B7280"}>
                                                {value}
                                            </text>
                                        </g>
                                    );
                                })}
                                <text
                                    x={padding - 42}
                                    y={height / 2}
                                    fontSize={isCompact ? "9" : "11"}
                                    textAnchor="middle"
                                    fill={isDarkMode ? "#9CA3AF" : "#6B7280"}
                                    transform={`rotate(-90 ${padding - 42} ${height / 2})`}
                                >
                                    {t.yAxisLabel}
                                </text>
                                <path d={createPath('total')} fill="none" stroke="#60A5FA" strokeWidth="4" />
                                <path d={createPath('big')} fill="none" stroke="#EF4444" strokeWidth="3" strokeDasharray="5 5" />
                                <path d={createPath('medium')} fill="none" stroke="#F97316" strokeWidth="3" strokeDasharray="3 3" />
                                <path d={createPath('small')} fill="none" stroke="#FACC15" strokeWidth="3" />
                                {showUnverified && (
                                    <path d={createPath('unverified')} fill="none" stroke="#9CA3AF" strokeWidth="3" strokeDasharray="2 2" />
                                )}
                                
                                {series.map((p, i) => <circle key={i} cx={getX(i)} cy={getY(p.total)} r={isCompact ? "3" : "4"} fill="#60A5FA" />)}
                                {series.map((p, i) => (
                                    <text
                                        key={i}
                                        x={getX(i)}
                                        y={height - 2}
                                        fontSize={isCompact ? "8" : "10"}
                                        textAnchor="end"
                                        fill={isDarkMode ? "#9CA3AF" : "#6B7280"}
                                        transform={`rotate(-35 ${getX(i)} ${height - 2})`}
                                    >
                                        {formatDateWithWeekday(p.date, lang)}
                                    </text>
                                ))}
                            </svg>
                        </div>
                     </div>
                </div>
            );
        };

        const IranMap = () => {
            const mapContainerRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const tileLayerRef = useRef(null);
            const markersRef = useRef([]); 
            
            const [isMapReady, setIsMapReady] = useState(false);
            const [activeLayer, setActiveLayer] = useState('light');
            const [zoomLevel, setZoomLevel] = useState(5);
            const [selectedIncident, setSelectedIncident] = useState(null);
            const [showGraph, setShowGraph] = useState(false);
            const [showUnverified, setShowUnverified] = useState(false);
            const [showAllTooltips, setShowAllTooltips] = useState(false);
            const [dateFilter, setDateFilter] = useState(null); 
            const [isPlaying, setIsPlaying] = useState(false);
            const [lang, setLang] = useState('en'); 
            
            // Animation State for Title
            const [isHeaderAnimating, setIsHeaderAnimating] = useState(false);

            // Mobile Panel State - Initial height 66% (2/3rds)
            const [panelHeight, setPanelHeight] = useState(window.innerHeight * 0.66);
            const [isDragging, setIsDragging] = useState(false);
            const dragStartY = useRef(0);
            const dragStartHeight = useRef(0);

            const isDarkMode = activeLayer === 'dark' || activeLayer === 'satellite';
            const t = translations[lang];

            useEffect(() => { document.body.classList.toggle('dark-theme', isDarkMode); }, [isDarkMode]);

            // --- Preload Twitter Script ---
            useEffect(() => {
                if (!document.getElementById('twitter-wjs')) {
                    const script = document.createElement('script');
                    script.id = 'twitter-wjs';
                    script.src = 'https://platform.twitter.com/widgets.js';
                    script.async = true;
                    document.body.appendChild(script);
                }
            }, []);

            // --- Hidden Tooltip Toggle (Desktop Only) ---
            useEffect(() => {
                const handleKeyDown = (event) => {
                    if (window.innerWidth < 768) return;
                    if (event.key && event.key.toLowerCase() === 'h') {
                        setShowAllTooltips(prev => !prev);
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

             // --- Data Definitions (Updated with 92 verified and 103 unverified) ---
            const verifiedIncidents = useMemo(() => [
                { "id": 1, "verified": true, "desc": "Protesters push back police and security forces on Jomhouri Street, Tehran", "desc_fa": "عقب راندن نیروهای پلیس و امنیتی توسط معترضان در خیابان جمهوری تهران", "coords": [35.6927461, 51.4255329], "link": "https://x.com/Shayan86/status/2005987583445090377", "date": "2025-12-30", "size": "big", "alt": null },
                { "id": 2, "verified": true, "desc": "Protesters outside Ghasr shopping centre on Qeshm Island", "desc_fa": "تجمع معترضان مقابل مرکز خرید قصر در جزیره قشم", "coords": [26.968793, 56.075395], "link": "https://x.com/Shayan86/status/2005999164979867916", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": 3, "verified": true, "desc": "Group gathered in Tehran", "desc_fa": "تجمع گروهی از مردم در تهران", "coords": [35.752619, 51.466106], "link": "https://x.com/GhonchehAzad/status/2005992119258038527", "date": "2025-12-30", "size": "big", "alt": null },
                { "id": 4, "verified": true, "desc": "Protester sits down in front of forces outside Charsou shopping centre on Jomhouri Street, Tehran", "desc_fa": "تحصن یک معترض مقابل نیروهای امنیتی روبروی پاساژ چارسو در خیابان جمهوری تهران", "coords": [35.695143, 51.412703], "link": "https://x.com/Shayan86/status/2006018573769019635", "date": "2025-12-30", "size": "small", "alt": null },
                { "id": 5, "verified": true, "desc": "Unrest with students running at University of Tehran (chants including \"death to the dictator\" and \"freedom\")", "desc_fa": "ناآرامی و شعار دادن دانشجویان در دانشگاه تهران (شعار مرگ بر دیکتاتور و آزادی)", "coords": [35.7036777, 51.3956859], "link": "https://x.com/GhonchehAzad/status/2006018665456501147", "date": "2025-12-30", "size": "medium", "alt": "https://x.com/Shayan86/status/2006039256603513166" },
                { "id": 6, "verified": true, "desc": "Woman leads chants of \"don't be afraid, we're all together\" in Tehran's Grand Bazaar", "desc_fa": "شعار «نترسید نترسید ما همه با هم هستیم» توسط یک زن در بازار بزرگ تهران", "coords": [35.6727692, 51.4214139], "link": "https://x.com/Shayan86/status/2006051668295647391", "date": "2025-12-30", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006036269298512269" },
                { "id": 7, "verified": true, "desc": "Clashes between police and protesters in Hamedan", "desc_fa": "درگیری بین پلیس و معترضان در همدان", "coords": [34.7954883, 48.5143633], "link": "https://x.com/GhonchehAzad/status/2006077897610797143", "date": "2025-12-30", "size": "medium", "alt": "https://x.com/Shayan86/status/2006728257450946936" },
                { "id": 8, "verified": true, "desc": "Man calls for help as protesters run from forces on Rajaei Street, Arak", "desc_fa": "درخواست کمک مردم در حالی که معترضان از نیروهای امنیتی در خیابان رجایی اراک فرار می‌کنند", "coords": [34.084962, 49.691045], "link": "https://x.com/Shayan86/status/2006174541567898093", "date": "2025-12-31", "size": "small", "alt": null },
                { "id": 9, "verified": true, "desc": "Shots fired at protesters on Imam Khomeini Street, Fasa", "desc_fa": "تیراندازی به سمت معترضان در خیابان امام خمینی فسا", "coords": [28.939864, 53.647716], "link": "https://x.com/Shayan86/status/2006332899751301458", "date": "2025-12-31", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2006331110993883448" },
                { "id": 10, "verified": true, "desc": "Protesters remove entrance gate of local government building in Fasa", "desc_fa": "معترضان در فرمانداری فسا را از جا کندند", "coords": [28.940212, 53.648819], "link": "https://x.com/Shayan86/status/2006412023597355302", "date": "2025-12-31", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006319069432012957" },
                { "id": 11, "verified": true, "desc": "Shots fired towards protesters at Imam Khomeini Square, Kuhdasht", "desc_fa": "تیراندازی به سمت معترضان در میدان امام خمینی کوهدشت", "coords": [33.533535, 47.607890], "link": "https://x.com/Shayan86/status/2006418603029987588", "date": "2025-12-31", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006403148684943839" },
                { "id": 12, "verified": true, "desc": "Protesters in Ramhormoz", "desc_fa": "تجمع معترضان در رامهرمز", "coords": [31.2800698, 49.6083711], "link": "https://x.com/GhonchehAzad/status/2006472230344220830", "date": "2025-12-31", "size": "medium", "alt": null },
                { "id": 13, "verified": true, "desc": "At least one individual arrested in front of Shahid Beheshti University dormitory, Tehran", "desc_fa": "بازداشت حداقل یک نفر مقابل خوابگاه دانشگاه شهید بهشتی تهران", "coords": [35.8059661, 51.3938244], "link": "https://x.com/GhonchehAzad/status/2006484693064270278", "date": "2025-12-31", "size": "small", "alt": null },
                { "id": 14, "verified": true, "desc": "Protests with fires and chants against Khamenei in Fuladshahr, Isfahan Province", "desc_fa": "اعتراضات، آتش زدن و شعار علیه خامنه‌ای در فولادشهر اصفهان", "coords": [32.482246, 51.404348], "link": "https://x.com/GeoConfirmed/status/2006392706881253489", "date": "2025-12-31", "size": "medium", "alt": null },
                { "id": 15, "verified": true, "desc": "Protesters set fire to local police station in Azna", "desc_fa": "به آتش کشیدن کانکس پلیس توسط معترضان در ازنا", "coords": [33.460733, 49.451621], "link": "https://x.com/Shayan86/status/2006850300645355614", "date": "2026-01-01", "size": "small", "alt": null },
                { "id": 16, "verified": true, "desc": "Chants of \"don't be afraid, we're all together\" in Karaj", "desc_fa": "شعار «نترسید ما همه با هم هستیم» در کرج", "coords": [35.842676, 50.971310], "link": "https://x.com/Shayan86/status/2006867020508430504", "date": "2026-01-01", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006811169957585230" },
                { "id": 17, "verified": true, "desc": "Protesters attacking and clashing with security forces in Marlik, Malard, Tehran Province", "desc_fa": "حمله و درگیری معترضان با نیروهای امنیتی در مارلیک ملارد", "coords": [35.69949, 50.98223], "link": "https://x.com/GeoConfirmed/status/2006767204038049828", "date": "2026-01-01", "size": "medium", "alt": "https://x.com/mhmiranusa/status/2006583893114204439" },
                { "id": 18, "verified": true, "desc": "Protests in fruit market 15 Khordad with chants", "desc_fa": "اعتراضات در بازار میوه ۱۵ خرداد همراه با شعار", "coords": [35.6715, 51.4223], "link": "https://x.com/FSeifikaran/status/2006656033947598938", "date": "2026-01-01", "size": "big", "alt": null },
                { "id": 19, "verified": true, "desc": "Protests in Lordegan with shooting at protesters", "desc_fa": "اعتراضات در لردگان و تیراندازی به معترضان", "coords": [31.5100, 50.8300], "link": "https://x.com/FSeifikaran/status/2006702462300991899", "date": "2026-01-01", "size": "big", "alt": null },
                { "id": 20, "verified": true, "desc": "Protests in Mashhad with chants \"Bi-sharaf\"", "desc_fa": "اعتراضات در مشهد با شعار «بی‌شرف»", "coords": [36.2605, 59.6168], "link": "https://x.com/FSeifikaran/status/2006802054476607667", "date": "2026-01-01", "size": "medium", "alt": null },
                { "id": 21, "verified": true, "desc": "Protests in Kavar with chants", "desc_fa": "اعتراضات در کوار همراه با شعار", "coords": [29.2050, 52.6910], "link": "https://x.com/FSeifikaran/status/2006771423977902211", "date": "2026-01-01", "size": "big", "alt": null },
                { "id": 22, "verified": true, "desc": "Protests in Asadabad with chants", "desc_fa": "اعتراضات در اسدآباد همراه با شعار", "coords": [34.7824, 48.1201], "link": "https://x.com/FSeifikaran/status/2006778812252766429", "date": "2026-01-01", "size": "big", "alt": null },
                { "id": 23, "verified": true, "desc": "Protesters pelt stones at bike-riding security forces on Del Azad Boulevard, Qom", "desc_fa": "پرتاب سنگ توسط معترضان به نیروهای امنیتی موتورسوار در بلوار دل‌آذر قم", "coords": [34.635653, 50.903530], "link": "https://x.com/Shayan86/status/2006883608489803839", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 24, "verified": true, "desc": "Protesters chant \"freedom, freedom, freedom\" on Maliabad Boulevard, Shiraz", "desc_fa": "شعار «آزادی آزادی آزادی» معترضان در بلوار معالی‌آباد شیراز", "coords": [29.6813125, 52.4621809], "link": "https://x.com/Shayan86/status/2007140469575463141", "date": "2026-01-02", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2006840481955852628" },
                { "id": 25, "verified": true, "desc": "Protesters march chanting in support of Pahlavi dynasty in central Marvdasht", "desc_fa": "راهپیمایی و شعار در حمایت از پهلوی در مرکز مرودشت", "coords": [29.874124, 52.800150], "link": "https://x.com/Shayan86/status/2007143719263420764", "date": "2026-01-02", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2006729302105104558" },
                { "id": 26, "verified": true, "desc": "Group gathers outside government-linked building with explosion heard in Lordegan", "desc_fa": "تجمع و شنیده شدن صدای انفجار مقابل یک ساختمان دولتی در لردگان", "coords": [31.519264, 50.824531], "link": "https://x.com/Shayan86/status/2007145981104795668", "date": "2026-01-02", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2006726390729814444" },
                { "id": 27, "verified": true, "desc": "Protesters chant \"people of Iran, scream and shout for your rights\" on Shariati Street, Babol", "desc_fa": "شعار «ایرانی داد بزن حقتو فریاد بزن» در خیابان شریعتی بابل", "coords": [36.565107, 52.678999], "link": "https://x.com/Shayan86/status/2007155657775227083", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 28, "verified": true, "desc": "Security forces detain a young woman near Haft Hoz Square, east Tehran", "desc_fa": "بازداشت خشونت‌آمیز یک زن جوان توسط نیروهای امنیتی در میدان هفت‌حوض تهران", "coords": [35.731604, 51.494020], "link": "https://x.com/Shayan86/status/2007158833781637299", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": 29, "verified": true, "desc": "Protesters outside police station with gunshots heard in Marvdasht", "desc_fa": "تجمع معترضان مقابل کلانتری و صدای تیراندازی در مرودشت", "coords": [29.880899, 52.808695], "link": "https://x.com/Shayan86/status/2007166728086925314", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 30, "verified": true, "desc": "Large group marching in central Marvdasht after a protester's death", "desc_fa": "راهپیمایی بزرگ در مرکز مرودشت پس از کشته شدن یک معترض", "coords": [29.878723, 52.806776], "link": "https://x.com/Shayan86/status/2007170005486711268", "date": "2026-01-02", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2007104961411522690" },
                { "id": 31, "verified": true, "desc": "Protesters chant \"death to the dictator\" on Khayyam Boulevard, Qazvin", "desc_fa": "شعار «مرگ بر دیکتاتور» در بلوار خیام قزوین", "coords": [36.280625, 50.009936], "link": "https://x.com/Shayan86/status/2007176433966465290", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": 32, "verified": true, "desc": "Protesters chant \"death to the dictator\" in Nazi Abad, south Tehran", "desc_fa": "شعار «مرگ بر دیکتاتور» در نازی‌آباد تهران", "coords": [35.6379206, 51.4049812], "link": "https://x.com/Shayan86/status/2007179679569264953", "date": "2026-01-02", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2007177746196369773, https://x.com/GhonchehAzad/status/2007490386294677543" },
                { "id": 33, "verified": true, "desc": "Large group chanting for Pahlavi dynasty return on Khayyam Boulevard, Qazvin", "desc_fa": "تجمع بزرگ و شعار در حمایت از پهلوی در بلوار خیام قزوین", "coords": [36.277281, 50.009420], "link": "https://x.com/Shayan86/status/2007187120134431022", "date": "2026-01-02", "size": "big", "alt": null },
                { "id": 34, "verified": true, "desc": "Group gathering on Tohid Boulevard, Qom", "desc_fa": "تجمع گروهی در بلوار توحید قم", "coords": [34.6440083, 50.8613519], "link": "https://x.com/Shayan86/status/2007214603500171285", "date": "2026-01-02", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2007130858772427133" },
                { "id": 35, "verified": true, "desc": "Banner of Qasem Soleimani set on fire near Zayande Rud river, Isfahan", "desc_fa": "آتش زدن بنر قاسم سلیمانی نزدیک زاینده‌رود اصفهان", "coords": [32.6436558, 51.6715999], "link": "https://x.com/Shayan86/status/2007343595926499504", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": 36, "verified": true, "desc": "Group chanting \"long live the Shah\" in Tehranpars, east Tehran", "desc_fa": "شعار «جاوید شاه» در تهرانپارس", "coords": [35.742378, 51.534020], "link": "https://x.com/Shayan86/status/2007345605467926884", "date": "2026-01-03", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2007231019070697694, https://x.com/GhonchehAzad/status/2007527025733751180" },
                { "id": 37, "verified": true, "desc": "Group chanting \"death to the entire regime\" near Haft Hoz Square, Narmak, east Tehran", "desc_fa": "شعار «مرگ بر کل نظام» در میدان هفت‌حوض نارمک", "coords": [35.728287, 51.493069], "link": "https://x.com/Shayan86/status/2007404687960768811", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": 38, "verified": true, "desc": "Group gathered in Kazerun, southern Fars Province", "desc_fa": "تجمع در کازرون، استان فارس", "coords": [29.6193901, 51.6542880], "link": "https://x.com/GhonchehAzad/status/2007387252855583080", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": 39, "verified": true, "desc": "Woman holding sign \"I’m not a rioter\" in Tehran", "desc_fa": "زنی با پلاکارد «من اغتشاشگر نیستم» در تهران", "coords": [35.63914, 51.41092], "link": "https://x.com/GhonchehAzad/status/2007497902902636989", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": 40, "verified": true, "desc": "Group chanting “Death to Khamenei” in Ilam, western Iran", "desc_fa": "شعار «مرگ بر خامنه‌ای» در ایلام", "coords": [33.6368095, 46.4218413], "link": "https://x.com/GhonchehAzad/status/2007488952362742103", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": 41, "verified": true, "desc": "Protesters gathered in front of Charsou, Tehran", "desc_fa": "تجمع معترضان مقابل پاساژ چارسو تهران", "coords": [35.69444, 51.41157], "link": "https://x.com/GhonchehAzad/status/2007820355914932569", "date": "2026-01-04", "size": "medium", "alt": null },
                { "id": 42, "verified": true, "desc": "Security officers shooting in western Ilam Province (towards a hospital)", "desc_fa": "تیراندازی نیروهای امنیتی در ایلام (به سمت بیمارستان)", "coords": [33.6368095, 46.4218413], "link": "https://x.com/GhonchehAzad/status/2007917698450423879", "date": "2026-01-04", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2007919876661502077, https://x.com/GhonchehAzad/status/2008236519363064247" },
                { "id": 43, "verified": true, "desc": "Security forces firing at protesters outside government complex in Arkavaz, Malekshahi County, Ilam Province (reported 4-8 killed, 30+ injured)", "desc_fa": "تیراندازی نیروهای امنیتی به معترضان مقابل فرمانداری ارکواز ملکشاهی ایلام (گزارش ۴-۸ کشته)", "coords": [33.39237, 46.59871], "link": "https://x.com/Mitch_Ulrich/status/2007667072223064529", "date": "2026-01-04", "size": "big", "alt": "https://x.com/Mitch_Ulrich/status/2007883928263417878" },
                { "id": 44, "verified": true, "desc": "Clashes with security forces at Imam Hussein Square in Shazand, Markazi Province", "desc_fa": "درگیری با نیروهای امنیتی در میدان امام حسین شازند", "coords": [33.93184, 49.40307], "link": "https://x.com/Mitch_Ulrich/status/2007945788392124873", "date": "2026-01-04", "size": "medium", "alt": null },
                { "id": 45, "verified": true, "desc": "Group of protesters singing “Ey Iran” in Sari, Mazandaran Province", "desc_fa": "گروهی از معترضان در حال خواندن سرود «ای ایران» در ساری، استان مازندران", "coords": [36.56332, 53.06009], "link": "https://x.com/GhonchehAzad/status/2008115146837860529", "date": "2026-01-05", "size": "medium", "alt": null },
                { "id": 46, "verified": true, "desc": "Group chanting “Freedom, Freedom, Freedom” in Yasuj, south-western Kohgiluyeh-Boyerahmad Province", "desc_fa": "شعار «آزادی آزادی آزادی» گروهی از معترضان در یاسوج", "coords": [30.66824, 51.58796], "link": "https://x.com/GhonchehAzad/status/2008155320590487813", "date": "2026-01-05", "size": "big", "alt": null },
                { "id": 47, "verified": true, "desc": "Group chanting “Death to Khamenei” and “Death to the Dictator” near Haft Hoz Square, east Tehran", "desc_fa": "شعار «مرگ بر خامنه‌ای» و «مرگ بر دیکتاتور» در نزدیکی میدان هفت حوض، شرق تهران", "coords": [35.73303, 51.49448], "link": "https://x.com/GhonchehAzad/status/2008256556396339598", "date": "2026-01-05", "size": "big", "alt": "https://x.com/cicikhanoom/status/2008202048895062308, https://x.com/GhonchehAzad/status/2008256732133544164, https://x.com/GhonchehAzad/status/2008256823032516967" },
                { "id": 48, "verified": true, "desc": "Group of protesters dispersed in Tehran", "desc_fa": "گروهی از معترضان در تهران پراکنده شدند", "coords": [35.6714683, 51.4222678], "link": "https://x.com/GhonchehAzad/status/2008519726167937275", "date": "2026-01-06", "size": "big", "alt": null },
                { "id": 49, "verified": true, "desc": "Protesters sitting in front of security forces in Tehran’s Grand Bazaar", "desc_fa": "تحصن معترضان مقابل نیروهای امنیتی در بازار بزرگ تهران", "coords": [35.6727692, 51.4214139], "link": "https://x.com/GhonchehAzad/status/2008489783765635162", "date": "2026-01-06", "size": "big", "alt": "https://x.com/Vahid/status/2008519182355492940" },
                { "id": 50, "verified": true, "desc": "Women's protest in Malekshahi with chants \"Death to the IRGC, Death to Khamenei\"", "desc_fa": "اعتراض زنان در ملکشاهی با شعار «مرگ بر سپاه، مرگ بر خامنه‌ای»", "coords": [33.3924, 46.5987], "link": "https://x.com/FSeifikaran/status/2008544165936902493", "date": "2026-01-06", "size": "big", "alt": null },
                { "id": 51, "verified": true, "desc": "Large protest in Abdanan with police waving at protesters", "desc_fa": "تظاهرات بزرگ در آبدانان و دست تکان دادن پلیس به معترضان", "coords": [32.9940, 47.4220], "link": "https://x.com/Shayan86/status/2008597601717731398", "date": "2026-01-06", "size": "big", "alt": "https://x.com/Shayan86/status/2008600507657711935, https://x.com/Shayan86/status/2008614935644045650, https://x.com/GeoConfirmed/status/2008587230567166025, https://x.com/FSeifikaran/status/2008575536352874570, https://x.com/GhonchehAzad/status/2008654725609398639, https://x.com/FSeifikaran/status/2008614230585733296" },
                { "id": 52, "verified": true, "desc": "Woman doused with water cannon but refuses to move on Mellat Street", "desc_fa": "مقاومت زنی در خیابان ملت در برابر آبپاش پلیس", "coords": [32.3247, 50.8513], "link": "https://x.com/Shayan86/status/2008614935644045650", "date": "2026-01-06", "size": "small", "alt": null },
                { "id": 53, "verified": true, "desc": "Multiple fires burning near Beheshti Square", "desc_fa": "آتش‌سوزی‌های متعدد نزدیک میدان بهشتی", "coords": [33.3851, 46.6001], "link": "https://x.com/Shayan86/status/2008623125999559083", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": 54, "verified": true, "desc": "Police van on fire in Ilam", "desc_fa": "ون پلیس در آتش در ایلام", "coords": [33.6426, 46.4230], "link": "https://x.com/GeoConfirmed/status/2008623128449098145", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": 55, "verified": true, "desc": "Security forces opening fire on protesters in Neyriz", "desc_fa": "تیراندازی نیروهای امنیتی به سمت معترضان در نی‌ریز", "coords": [29.1999, 54.3273], "link": "https://x.com/GeoConfirmed/status/2008625573719920750", "date": "2026-01-06", "size": "medium", "alt": "https://x.com/Vahid/status/2008638205503967507" },
                { "id": 56, "verified": true, "desc": "Security forces fire tear gas inside the courtyard of Sina Hospital in Tehran", "desc_fa": "شلیک گاز اشک‌آور توسط نیروهای امنیتی داخل حیاط بیمارستان سینا تهران", "coords": [35.686469, 51.412224], "link": "https://x.com/Shayan86/status/2008729911008391483", "date": "2026-01-06", "size": "medium", "alt": "https://x.com/FaytuksNetwork/status/2008531821819212145" },
                { "id": 57, "verified": true, "desc": "Protesters gather and security forces fire tear gas near 17 Shahrivar Square in Mashhad", "desc_fa": "تجمع معترضان و شلیک گاز اشک‌آور توسط نیروهای امنیتی نزدیک میدان ۱۷ شهریور مشهد", "coords": [36.2765, 59.6152], "link": "https://x.com/Shayan86/status/2008734617864728936", "date": "2026-01-06", "size": "big", "alt": "https://x.com/Shayan86/status/2008738771915993246" },
                { "id": 58, "verified": true, "desc": "Group gathered in Bojnourd, north-eastern North Khorasan Province", "desc_fa": "تجمع گروهی در بجنورد، شمال شرقی استان خراسان شمالی", "coords": [37.4765, 57.3310], "link": "https://x.com/GhonchehAzad/status/2008837886049931743", "date": "2026-01-07", "size": "big", "alt": null },
                { "id": 59, "verified": true, "desc": "Group gathered with chants \"Zehi khiyal batel, Khamenei qatel\" in Neyshabour, north-eastern Khorasan Razavi Province", "desc_fa": "تجمع گروهی با شعار «زهی خیال باطل، خامنه‌ای قاتل» در نیشابور، شمال شرقی استان خراسان رضوی", "coords": [36.2092, 58.7954], "link": "https://x.com/GhonchehAzad/status/2008835977671025090", "date": "2026-01-07", "size": "big", "alt": "https://x.com/FSeifikaran/status/2008838232554013044" },
                { "id": 60, "verified": true, "desc": "Protesters in the port city of Bandar-Abbas, Hormozgan Province", "desc_fa": "معترضان در شهر بندری بندرعباس، استان هرمزگان", "coords": [27.1795, 56.2755], "link": "https://x.com/GhonchehAzad/status/2008844406569476504", "date": "2026-01-07", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2008846671866900684" },
                { "id": 61, "verified": true, "desc": "Shooting at protesters in Kermanshah", "desc_fa": "تیراندازی به معترضان در کرمانشاه", "coords": [34.3276, 47.0770], "link": "https://x.com/FSeifikaran/status/2008843744980967763", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": 62, "verified": true, "desc": "Protesters in the religious city of Mashhad chant in favour of pre-1979 Pahlavi monarchy", "desc_fa": "شعار معترضان در شهر مذهبی مشهد در حمایت از سلطنت پهلوی", "coords": [36.2605, 59.6168], "link": "https://x.com/GhonchehAzad/status/2008863369722528197", "date": "2026-01-07", "size": "big", "alt": null },
                { "id": 63, "verified": true, "desc": "Protesters chanting against Iran’s Supreme Leader in Gilangharb, western Kermanshah Province", "desc_fa": "شعار معترضان علیه رهبر جمهوری اسلامی در گیلانغرب، استان کرمانشاه", "coords": [34.1415, 45.9182], "link": "https://x.com/GhonchehAzad/status/2008939384913940552", "date": "2026-01-07", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2008940076806623656" },
                { "id": 64, "verified": true, "desc": "Protesters in Abadan, Khuzestan Province", "desc_fa": "معترضان در آبادان، استان خوزستان", "coords": [30.3430, 48.2810], "link": "https://x.com/GhonchehAzad/status/2008924692875301053", "date": "2026-01-07", "size": "big", "alt": null },
                { "id": 65, "verified": true, "desc": "Group of protesters in Tehran’s Yaft Abad", "desc_fa": "گروهی از معترضان در یافت‌آباد تهران", "coords": [35.6625, 51.3281], "link": "https://x.com/GhonchehAzad/status/2008908712711172481", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": 66, "verified": true, "desc": "Group gathered with chants “This is the last battle, Pahlavi will return” in Aligoudarz, western Lorestan Province", "desc_fa": "تجمع گروهی با شعار «این آخرین نبرده، پهلوی برمی‌گرده» در الیگودرز، استان لرستان", "coords": [33.4009, 49.6949], "link": "https://x.com/GhonchehAzad/status/2008987431656411199", "date": "2026-01-07", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2008987618667860232" },
                { "id": 67, "verified": true, "desc": "A massive Islamic Republic of Iran flag was taken down and torn apart", "desc_fa": "پرچم بزرگ جمهوری اسلامی ایران پایین کشیده و پاره شد", "coords": [36.311031, 59.653486], "link": "https://x.com/FaytuksNetwork/status/2009025066508681515", "date": "2026-01-07", "size": "big", "alt": null },
                { "id": 68, "verified": true, "desc": "Protesters destroying a statue of Qassem Soleimani in Qaemyeh, Fars Province", "desc_fa": "معترضان مجسمه قاسم سلیمانی را در قایمیه، استان فارس تخریب کردند", "coords": [29.9350, 51.5790], "link": "https://x.com/GhonchehAzad/status/2009016968184270999", "date": "2026-01-07", "size": "medium", "alt": "https://x.com/GhonchehAzad/status/2009017123180613775, https://x.com/GhonchehAzad/status/2009025655573209538" },
                { "id": 69, "verified": true, "desc": "Protesters in Rasht", "desc_fa": "معترضان در رشت", "coords": [37.27064, 49.592624], "link": "https://x.com/GhonchehAzad/status/2008899568985854437", "date": "2026-01-07", "size": "big", "alt": null },
                { "id": 70, "verified": true, "desc": "Protesters looted the offices of Bank Keshavarzi (linked to the IRGC)", "desc_fa": "معترضان دفاتر بانک کشاورزی (مرتبط با سپاه) را غارت کردند", "coords": [33.564846, 46.815202], "link": "https://x.com/zarGEOINT/status/2009208700586918029", "date": "2026-01-07", "size": "small", "alt": null },
                { "id": 71, "verified": true, "desc": "Shops on strike", "desc_fa": "اعتصاب مغازه‌ها", "coords": [35.317605, 47.00473], "link": "https://x.com/GhonchehAzad/status/2009197312221040939", "date": "2026-01-07", "size": "small", "alt": null },
                { "id": 72, "verified": true, "desc": "Group of protesters", "desc_fa": "گروهی از معترضان", "coords": [35.7246332, 51.3276848], "link": "https://x.com/GhonchehAzad/status/2009313256847102387", "date": "2026-01-08", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2009330922362159577?s=20" },
                { "id": 73, "verified": true, "desc": "Protesters chant “Javid Shah” - “Long Live the King” in favour of pre-1979 Pahlavi monarchy in Babol, northern Mazandaran Province", "desc_fa": "شعار «جاوید شاه» در حمایت از پادشاهی پهلوی پیش از ۱۹۷۹ در بابل، استان مازندران", "coords": [36.5465, 52.6786], "link": "https://x.com/GhonchehAzad/status/2009319292576387194", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 74, "verified": true, "desc": "Protesters being arrested and shot at in Kermanshah, western Iran", "desc_fa": "بازداشت و تیراندازی به معترضان در کرمانشاه، غرب ایران", "coords": [34.3742, 47.1444], "link": "https://x.com/GhonchehAzad/status/2009261458442399850", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": 75, "verified": true, "desc": "A large crowd of protesters marches down 17 Shahrivar Street in Tabriz", "desc_fa": "راهپیمایی جمعیت بزرگی از معترضان در خیابان ۱۷ شهریور تبریز", "coords": [38.067658, 46.280951], "link": "https://x.com/Shayan86/status/2009345748081758540", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 76, "verified": true, "desc": "Protesters on Tehran's Shariati Street try to bring down the flag of the Islamic Republic", "desc_fa": "معترضان در خیابان شریعتی تهران تلاش می‌کنند پرچم جمهوری اسلامی را پایین بکشند", "coords": [35.767421, 51.441861], "link": "https://x.com/Shayan86/status/2009367925765865789", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": 77, "verified": true, "desc": "A protester raises the pre-1979 sun and lion flag in Razi Square in Khorramabad", "desc_fa": "یک معترض پرچم شیر و خورشید پیش از ۱۹۷۹ را در میدان رازی خرم‌آباد برافراشت", "coords": [33.505968, 48.360802], "link": "https://x.com/Shayan86/status/2009377360894640295", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 78, "verified": true, "desc": "Protesters on Takhti Street in Rasht chant \"[Reza] Pahlavi will return\"", "desc_fa": "معترضان در خیابان تختی رشت شعار می‌دهند «پهلوی برمی‌گرده»", "coords": [37.27064, 49.592624], "link": "https://x.com/Shayan86/status/2009387306285744391", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 79, "verified": true, "desc": "Crowd of protesters in Gorgan chanting “Death to the Dictator”", "desc_fa": "جمعیت معترضان در گرگان شعار «مرگ بر دیکتاتور» سر می‌دهند", "coords": [36.833255, 54.439778], "link": "https://x.com/GhonchehAzad/status/2009339049723744406", "date": "2026-01-08", "size": "big", "alt": "https://x.com/GhonchehAzad/status/2009339287805022576" },
                { "id": 80, "verified": true, "desc": "Protesters in Kish Island chanting in favour of pre-1979 Pahlavi monarchy", "desc_fa": "معترضان در جزیره کیش در حمایت از پادشاهی پهلوی پیش از ۱۹۷۹ شعار می‌دهند", "coords": [26.5394, 54.0206], "link": "https://x.com/GhonchehAzad/status/2009353393861800389", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 81, "verified": true, "desc": "Burning of IRIB (state media) building in Isfahan", "desc_fa": "آتش‌سوزی ساختمان صداوسیما (IRIB) در اصفهان", "coords": [32.640921, 51.651810], "link": "https://x.com/FSeifikaran/status/2009354444627169640", "date": "2026-01-08", "size": "small", "alt": "https://x.com/FSeifikaran/status/2009371541738258597" },
                { "id": 82, "verified": true, "desc": "Protesters set fires inside the governor’s compound in Gorgan", "desc_fa": "معترضان در محوطه فرمانداری گرگان آتش روشن کردند", "coords": [36.83679, 54.43582], "link": "https://x.com/FSeifikaran/status/2009376196543267254", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 83, "verified": true, "desc": "Burning of Qassem Soleimani statue in Kerman", "desc_fa": "آتش زدن مجسمه قاسم سلیمانی در کرمان", "coords": [30.287466, 57.05243], "link": "https://x.com/FSeifikaran/status/2009417105154949439", "date": "2026-01-08", "size": "small", "alt": "https://x.com/GhonchehAzad/status/2009430317346509155, https://x.com/GeoConfirmed/status/2009442008767844849" },
                { "id": 84, "verified": true, "desc": "Chants of \"death to the dictator\" and \"death to Khamenei\" on Dolat Street in north Tehran", "desc_fa": "شعار «مرگ بر دیکتاتور» و «مرگ بر خامنه‌ای» در خیابان دولت در شمال تهران", "coords": [35.780451, 51.453411], "link": "https://x.com/Shayan86/status/2009415227222413743", "date": "2026-01-08", "size": "medium", "alt": "https://x.com/GeoConfirmed/status/2009440929468268842" },
                { "id": 85, "verified": true, "desc": "Large crowd gathered near the Gholhak district in north Tehran", "desc_fa": "تجمع جمعیت بزرگی در نزدیکی محله قلهک در شمال تهران", "coords": [35.767244, 51.441978], "link": "https://x.com/Shayan86/status/2009427374304055418", "date": "2026-01-08", "size": "big", "alt": "https://x.com/GeoConfirmed/status/2009441031344025729" },
                { "id": 86, "verified": true, "desc": "Multiple vehicles on fire in Kaj Square in Tehran's Saadat Abad district as protesters chant \"Pahlavi will return\"", "desc_fa": "آتش‌سوزی چند خودرو در میدان کاج در سعادت‌آباد تهران همزمان با شعار «پهلوی برمی‌گرده»", "coords": [35.7822773, 51.3746329], "link": "https://x.com/Shayan86/status/2009406927210508360", "date": "2026-01-08", "size": "big", "alt": "https://x.com/GeoConfirmed/status/2009440830793056501" },
                { "id": 87, "verified": true, "desc": "Large crowd marching down Khanzadeh Blvd in Mehrshahr, Karaj", "desc_fa": "راهپیمایی جمعیت بزرگی در بلوار خانزاده در مهرشهر کرج", "coords": [35.812787, 50.937517], "link": "https://x.com/Shayan86/status/2009448144443199709", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 88, "verified": true, "desc": "Multiple vehicles belonging to police and security forces set on fire in Moalem Square in Yazd", "desc_fa": "به آتش کشیدن چند خودرو متعلق به پلیس و نیروهای امنیتی در میدان معلم یزد", "coords": [31.897506, 54.340780], "link": "https://x.com/Shayan86/status/2009477160390807632", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": 89, "verified": true, "desc": "Protesters storm the local government building in Imam Khomeini Square and set it on fire in Shazand", "desc_fa": "یورش معترضان به ساختمان فرمانداری در میدان امام خمینی شازند و آتش زدن آن", "coords": [33.931456, 49.410447], "link": "https://x.com/Shayan86/status/2009482509625819154", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": 90, "verified": true, "desc": "Protesters chant \"death to the dictator\" under the Karimkhan Zand Bridge in central Tehran", "desc_fa": "شعار «مرگ بر دیکتاتور» معترضان زیر پل کریمخان زند در مرکز تهران", "coords": [35.7153281, 51.4189591], "link": "https://x.com/Shayan86/status/2009489783958143023", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": 91, "verified": true, "desc": "Protesters in Shahrud, Semnan Province", "desc_fa": "تجمع معترضان در شاهرود، استان سمنان", "coords": [36.42441, 54.96679], "link": "https://x.com/thestevennabil/status/2009395866587812315", "date": "2026-01-08", "size": "medium", "alt": "https://x.com/GeoConfirmed/status/2009440733120315690" },
                { "id": 92, "verified": true, "desc": "A massive crowd of protesters march along the Vakil Abad Freeway in Mashhad", "desc_fa": "راهپیمایی جمعیت عظیم معترضان در آزادراه وکیل‌آباد مشهد", "coords": [36.32624, 59.50516], "link": "https://x.com/MohamadAhwaze/status/2009402277514113074", "date": "2026-01-08", "size": "big", "alt": "https://x.com/Mitch_Ulrich/status/2009433239346401611, https://x.com/GeoConfirmed/status/2009441128055992786" }
            ], []);

            // --- Unverified Data (Same as provided) ---
            const unverifiedIncidents = useMemo(() => [
                { "id": "u1", "verified": false, "desc": "Protesters marching on Ferdowsi Street near Sar Manouchehri", "desc_fa": "معترضان در حال راهپیمایی در خیابان فردوسی نزدیک سر منوچهری", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2005629230886072346", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": "u2", "verified": false, "desc": "Gathering and protests outside Ghasr shopping center", "desc_fa": "تجمع و اعتراضات خارج از مرکز خرید قصر", "coords": [26.9584, 56.2716], "link": "https://x.com/Vahid/status/2005667136111571200", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": "u3", "verified": false, "desc": "Protests and clashes in Marlik", "desc_fa": "اعتراضات و درگیری‌ها در مارلیک", "coords": [35.6995, 50.9822], "link": "https://x.com/Vahid/status/2005666037942136865", "date": "2025-12-30", "size": "medium", "alt": null },
                { "id": "u4", "verified": false, "desc": "Chants of 'We fight, we die, we take back Iran!' and 'Reza Shah, rest in peace!' in protests", "desc_fa": "شعارهای 'می‌جنگیم، می‌میریم، ایران رو پس می‌گیریم!' و 'رضا شاه روحت شاد!' در اعتراضات", "coords": [34.0850, 49.6910], "link": "https://x.com/Vahid/status/2006449186158633432", "date": "2025-12-31", "size": "medium", "alt": null },
                { "id": "u5", "verified": false, "desc": "Student gathering and chants of 'Death to Khamenei' at dorms", "desc_fa": "تجمع دانشجویی و شعارهای 'مرگ بر خامنه‌ای' در خوابگاه‌ها", "coords": [35.8060, 51.3938], "link": "https://x.com/Vahid/status/2006508642191945737", "date": "2026-01-01", "size": "medium", "alt": null },
                { "id": "u6", "verified": false, "desc": "Woman detained by security forces", "desc_fa": "زن توسط نیروهای امنیتی بازداشت شد", "coords": [35.7283, 51.4931], "link": "https://x.com/Vahid/status/2007146339910726125", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": "u7", "verified": false, "desc": "Woman detained by security forces near Old Darayi Street (15 Khordad) towards Soumeh Blvd", "desc_fa": "زن توسط نیروهای امنیتی نزدیک خیابان درایی قدیمی (۱۵ خرداد) به سمت بلوار سومه بازداشت شد", "coords": [36.2133, 58.7958], "link": "https://x.com/Vahid/status/2007193627454517691", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": "u8", "verified": false, "desc": "Chants of 'No pain is just the hijab, you took our lives!'", "desc_fa": "شعارهای 'درد ما فقط حجاب نیست، جان ما را گرفتید!'", "coords": [35.7424, 51.5340], "link": "https://x.com/Vahid/status/2007239451777610050", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u9", "verified": false, "desc": "Protesters sitting in front of security forces, blocking the street", "desc_fa": "معترضان در مقابل نیروهای امنیتی نشسته، خیابان را مسدود کرده‌اند", "coords": [29.5926, 52.5837], "link": "https://x.com/Vahid/status/2007427222697566259", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u10", "verified": false, "desc": "Chants of 'Death to the dictator'", "desc_fa": "شعارهای 'مرگ بر دیکتاتور'", "coords": [35.6379, 51.4050], "link": "https://x.com/Vahid/status/2007487965828915655", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u11", "verified": false, "desc": "Woman with sign 'I'm not a rioter' amid protesters pulling down flags", "desc_fa": "زن با پلاکارد 'من آشوبگر نیستم' در میان معترضان که پرچم‌ها را پایین می‌کشند", "coords": [35.6379, 51.4050], "link": "https://x.com/Vahid/status/2007489750794744143", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u12", "verified": false, "desc": "Chants of 'Death to Khamenei' on Rahnamai Street", "desc_fa": "شعارهای 'مرگ بر خامنه‌ای' در خیابان راهنمایی", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007497928928309468", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u13", "verified": false, "desc": "Chants of 'Death to the dictator' at second square", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' در میدان دوم", "coords": [35.7424, 51.5340], "link": "https://x.com/Vahid/status/2007515360451555718", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u14", "verified": false, "desc": "Chants of 'Death to the dictator' and 'Long live the Shah!'", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' و 'جاوید شاه!'", "coords": [35.7316, 51.4940], "link": "https://x.com/Vahid/status/2007516003002130533", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u15", "verified": false, "desc": "Chants of 'This is the last battle, Pahlavi will return!' amid breaking glass at Bassij base", "desc_fa": "شعارهای 'این آخرین نبرده، پهلوی بر می‌گرده!' در میان شکستن شیشه در پایگاه بسیج", "coords": [35.7283, 51.4931], "link": "https://x.com/Vahid/status/2007521713920057641", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u16", "verified": false, "desc": "Chants of 'Death to the dictator' at Zafarqandi entrance to Baqeri highway", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' در ورودی ظفرقندی به بزرگراه باقری", "coords": [35.7330, 51.4945], "link": "https://x.com/Vahid/status/2007524799812436236", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u17", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [35.7424, 51.5340], "link": "https://x.com/Vahid/status/2007526668122849775", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u18", "verified": false, "desc": "Chants of 'Death to the dictator' amid pulling down signs and blocking road", "desc_fa": "شعارهای 'مرگ بر دیکتاتور' در میان پایین کشیدن علائم و مسدود کردن جاده", "coords": [35.7283, 51.4931], "link": "https://x.com/Vahid/status/2007529249905738016", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u19", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2007532441246818733", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u20", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [37.2682, 49.5891], "link": "https://x.com/Vahid/status/2007533623667495039", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u21", "verified": false, "desc": "Protesters in front of governorate building", "desc_fa": "معترضان در مقابل ساختمان استانداری", "coords": [29.1989, 54.3278], "link": "https://x.com/Vahid/status/2007536991819432354", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u22", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [30.3500, 50.7500], "link": "https://x.com/Vahid/status/2007541186274439265", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u23", "verified": false, "desc": "Chants of 'This is the last battle, Pahlavi will return!' and 'Long live the Shah!'", "desc_fa": "شعارهای 'این آخرین نبرده، پهلوی بر می‌گرده!' و 'جاوید شاه!'", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007545010288214076", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u24", "verified": false, "desc": "Chants of 'This police is the killer itself!'", "desc_fa": "شعارهای 'این پلیس خودش قاتل است!'", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007553960912277782", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u25", "verified": false, "desc": "Chants of 'Until the mullah is buried, this homeland won't be a homeland!'", "desc_fa": "شعارهای 'تا آخوند کفن نشه این وطن وطن نشه!'", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2007557144397406306", "date": "2026-01-03", "size": "medium", "alt": null },
                { "id": "u26", "verified": false, "desc": "Security forces attacking protesters in hospital", "desc_fa": "نیروهای امنیتی به معترضان در بیمارستان حمله می‌کنند", "coords": [33.6384, 46.4226], "link": "https://x.com/Vahid/status/2007917006776094736", "date": "2026-01-04", "size": "small", "alt": null },
                { "id": "u27", "verified": false, "desc": "Security forces firing tear gas at protesters", "desc_fa": "نیروهای امنیتی گاز اشک‌آور به سمت معترضان شلیک می‌کنند", "coords": [32.6539, 51.6660], "link": "https://x.com/Vahid/status/2008240478656098516", "date": "2026-01-05", "size": "medium", "alt": null },
                { "id": "u28", "verified": false, "desc": "Graffiti on overpass: 'Until the mullah is buried, this homeland won't be a homeland!'", "desc_fa": "گرافیتی روی پل هوایی: 'تا آخوند کفن نشه این وطن وطن نشه!'", "coords": [35.7600, 51.4300], "link": "https://x.com/Vahid/status/2008328901148205280", "date": "2026-01-05", "size": "small", "alt": null },
                { "id": "u29", "verified": false, "desc": "Elderly man beaten with baton", "desc_fa": "پیرمرد با باتوم مورد ضرب و شتم قرار گرفت", "coords": [32.3256, 50.8644], "link": "https://x.com/Vahid/status/2008488616671285415", "date": "2026-01-06", "size": "small", "alt": null },
                { "id": "u30", "verified": false, "desc": "Tear gas fired on Saadi Street", "desc_fa": "شلیک گاز اشک‌آور در خیابان سعدی", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2008496505364377703", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u31", "verified": false, "desc": "Chants of 'Long live the Shah!' and 'Death to the dictator!' in Hamam Chal Alley", "desc_fa": "شعارهای 'جاوید شاه!' و 'مرگ بر دیکتاتور!' در کوچه حمام چال", "coords": [35.6728, 51.4214], "link": "https://x.com/Vahid/status/2008503951281586479", "date": "2026-01-06", "size": "small", "alt": null },
                { "id": "u32", "verified": false, "desc": "Agents closed hospital door with gunshots heard", "desc_fa": "مأموران درب بیمارستان را بستند و صدای تیراندازی شنیده شد", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2008519182355492940", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u33", "verified": false, "desc": "Gathering on Imam Hossein Square, Mazandaran Street", "desc_fa": "تجمع در میدان امام حسین، خیابان مازندران", "coords": [35.7075, 51.4350], "link": "https://x.com/Vahid/status/2008536730283205067", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u34", "verified": false, "desc": "Protesters hit with paintball guns", "desc_fa": "معترضان هدف گلوله‌های پینت‌بال قرار گرفتند", "coords": [36.2605, 59.6168], "link": "https://x.com/Vahid/status/2008540439272669508", "date": "2026-01-06", "size": "small", "alt": null },
                { "id": "u35", "verified": false, "desc": "Protests underway", "desc_fa": "اعتراضات در جریان است", "coords": [32.6539, 51.6660], "link": "https://x.com/FaytuksNetwork/status/2006785806715990341", "date": "2026-01-01", "size": "small", "alt": null },
                { "id": "u36", "verified": false, "desc": "Protesters blocked street and chanted", "desc_fa": "معترضان خیابان را بستند و شعار دادند", "coords": [36.2806, 50.0099], "link": "https://x.com/FaytuksNetwork/status/2007262733633499197", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u37", "verified": false, "desc": "Protesters confirmed", "desc_fa": "حضور معترضان تایید شد", "coords": [35.7424, 51.5340], "link": "https://x.com/FaytuksNetwork/status/2007105753560019118", "date": "2026-01-02", "size": "small", "alt": null },
                { "id": "u38", "verified": false, "desc": "Protesters stand ground in front of water cannon", "desc_fa": "ایستادگی معترضان در برابر ماشین آب‌پاش", "coords": [34.7955, 48.5144], "link": "https://x.com/FaytuksNetwork/status/2007042104959402413", "date": "2026-01-02", "size": "medium", "alt": null },
                { "id": "u39", "verified": false, "desc": "Protesters set fire to statue", "desc_fa": "آتش زدن مجسمه توسط معترضان", "coords": [32.3343, 49.0914], "link": "https://x.com/FaytuksNetwork/status/2006826834193961402", "date": "2026-01-01", "size": "medium", "alt": null },
                { "id": "u40", "verified": false, "desc": "Protests continue", "desc_fa": "ادامه اعتراضات", "coords": [33.5634, 46.5658], "link": "https://x.com/FaytuksNetwork/status/2007249260778270776", "date": "2026-01-03", "size": "small", "alt": null },
                { "id": "u41", "verified": false, "desc": "Security forces in front of hospital with screams heard", "desc_fa": "نیروهای امنیتی مقابل بیمارستان و صدای فریاد", "coords": [33.6370, 46.4208], "link": "https://x.com/FaytuksNetwork/status/2007916014546346316", "date": "2026-01-04", "size": "small", "alt": null },
                { "id": "u42", "verified": false, "desc": "Protesters breaking into a bank", "desc_fa": "شکستن شیشه‌های بانک توسط معترضان", "coords": [33.3851, 46.6002], "link": "https://x.com/FaytuksNetwork/status/2008568012694253582", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u43", "verified": false, "desc": "Protesters in the city", "desc_fa": "حضور معترضان در سطح شهر", "coords": [33.3850, 46.5999], "link": "https://x.com/FaytuksNetwork/status/2008565817659761115", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u44", "verified": false, "desc": "Tear gas was fired into the entrance of hospital", "desc_fa": "شلیک گاز اشک‌آور به ورودی بیمارستان", "coords": [35.6863, 51.4121], "link": "https://x.com/FaytuksNetwork/status/2008531821819212145", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u45", "verified": false, "desc": "Video shows police waving at demonstrators", "desc_fa": "ویدیو نشان می‌دهد پلیس برای تظاهرکنندگان دست تکان می‌دهد", "coords": [32.9927, 47.4198], "link": "https://x.com/FaytuksNetwork/status/2008576732308418982", "date": "2026-01-06", "size": "small", "alt": "https://x.com/FaytuksNetwork/status/2008588742257430636" },
                { "id": "u46", "verified": false, "desc": "Car drove into group of security-force motorcyclists", "desc_fa": "خودرو به گروهی از موتورسواران نیروهای امنیتی برخورد کرد", "coords": [29.5926, 52.5837], "link": "https://x.com/FaytuksNetwork/status/2008586294914675140", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u47", "verified": false, "desc": "Police van on fire", "desc_fa": "ون پلیس در آتش", "coords": [33.6426, 46.4230], "link": "https://x.com/FaytuksNetwork/status/2008623128449098145", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u48", "verified": false, "desc": "Security forces opening fire on protesters", "desc_fa": "نیروهای امنیتی به سمت معترضان آتش گشودند", "coords": [29.1999, 54.3273], "link": "https://x.com/FaytuksNetwork/status/2008625573719920750", "date": "2026-01-06", "size": "big", "alt": "https://x.com/Vahid/status/2008638205503967507" },
                { "id": "u49", "verified": false, "desc": "Chants in protests", "desc_fa": "شعار دادن در اعتراضات", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2008615094436196660", "date": "2026-01-06", "size": "medium", "alt": null },
                { "id": "u50", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [27.1795, 56.2755], "link": "https://x.com/Vahid/status/2008839633468326243", "date": "2026-01-07", "size": "medium", "alt": "https://x.com/Vahid/status/2008840352132968706" },
                { "id": "u51", "verified": false, "desc": "Chants of \"Merchant with honor, support, support!\"", "desc_fa": "شعارهای \"بازاری با غیرت، حمایت، حمایت\"", "coords": [30.2839, 57.0834], "link": "https://x.com/Vahid/status/2008844818466959368", "date": "2026-01-07", "size": "medium", "alt": "https://x.com/Vahid/status/2008845102224158769, https://x.com/Vahid/status/2008848486054420683, https://x.com/Vahid/status/2008848787469693231" },
                { "id": "u52", "verified": false, "desc": "Violence by suppressive forces", "desc_fa": "خشونت توسط نیروهای سرکوبگر", "coords": [36.2133, 58.7958], "link": "https://x.com/Vahid/status/2009061187317891475", "date": "2026-01-07", "size": "small", "alt": "https://x.com/Vahid/status/2009059420123353361, https://x.com/Vahid/status/2008990482073112881" },
                { "id": "u53", "verified": false, "desc": "Direct shooting", "desc_fa": "تیراندازی مستقیم", "coords": [30.3430, 48.2810], "link": "https://x.com/Vahid/status/2009059420123353361", "date": "2026-01-07", "size": "small", "alt": null },
                { "id": "u54", "verified": false, "desc": "Gathering and protests", "desc_fa": "تجمع و اعتراضات", "coords": [37.3739, 49.7485], "link": "https://x.com/Vahid/status/2009057253480124531", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u55", "verified": false, "desc": "Chants of \"Khamenei murderer, your imagination is void!\" and shooting effects", "desc_fa": "شعار «خامنه‌ای قاتل، خیال تو باطل!» و آثار تیراندازی", "coords": [34.3529, 58.6837], "link": "https://x.com/Vahid/status/2009052935368659359", "date": "2026-01-07", "size": "medium", "alt": "https://x.com/Vahid/status/2008970055154119091" },
                { "id": "u56", "verified": false, "desc": "Gathering and protests", "desc_fa": "تجمع و اعتراضات", "coords": [36.2806, 50.0099], "link": "https://x.com/Vahid/status/2009049620123353361", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u57", "verified": false, "desc": "Chants of \"Javid Shah!\" and \"This is the last battle, Pahlavi will return!\"", "desc_fa": "شعارهای «جاوید شاه!» و «این آخرین نبرده، پهلوی برمی‌گرده!»", "coords": [37.5581, 56.9265], "link": "https://x.com/Vahid/status/2009032212700643767", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u58", "verified": false, "desc": "Disabling surveillance camera", "desc_fa": "از کار انداختن دوربین نظارتی", "coords": [32.5553, 51.5097], "link": "https://x.com/Vahid/status/2009027604003606585", "date": "2026-01-07", "size": "small", "alt": null },
                { "id": "u59", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [30.2839, 57.0834], "link": "https://x.com/Vahid/status/2009024949080797461", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u60", "verified": false, "desc": "Chants of \"Javid Shah!\"", "desc_fa": "شعار «جاوید شاه!»", "coords": [33.8938, 48.7563], "link": "https://x.com/Vahid/status/2009020872032702636", "date": "2026-01-07", "size": "small", "alt": null },
                { "id": "u61", "verified": false, "desc": "Chants of \"This is the last battle, Pahlavi will return!\"", "desc_fa": "شعار «این آخرین نبرده، پهلوی برمی‌گرده!»", "coords": [35.7564, 52.7692], "link": "https://x.com/Vahid/status/2009004746330526120", "date": "2026-01-07", "size": "small", "alt": null },
                { "id": "u62", "verified": false, "desc": "Chants of \"Javid Shah!\" and tear gas", "desc_fa": "شعار «جاوید شاه!» و گاز اشک‌آور", "coords": [36.8163, 50.8738], "link": "https://x.com/Vahid/status/2009001132966944783", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u63", "verified": false, "desc": "Chants of \"Death to the dictator\" and tear gas and gunshots", "desc_fa": "شعار «مرگ بر دیکتاتور» و گاز اشک‌آور و تیراندازی", "coords": [36.2133, 58.7958], "link": "https://x.com/Vahid/status/2008993328403198201", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u64", "verified": false, "desc": "Chants of \"This is the last battle, Pahlavi will return!\"", "desc_fa": "شعار «این آخرین نبرده، پهلوی برمی‌گرده!»", "coords": [35.7069, 59.8501], "link": "https://x.com/Vahid/status/2008984493567430983", "date": "2026-01-07", "size": "small", "alt": "https://x.com/Vahid/status/2008983459474362371" },
                { "id": "u65", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [36.6455, 59.1212], "link": "https://x.com/Vahid/status/2008975484156301563", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u66", "verified": false, "desc": "Security forces firing with shotguns in the direction of protesters", "desc_fa": "تیراندازی نیروهای امنیتی با ساچمه‌زن به سمت معترضان", "coords": [27.8344, 52.0627], "link": "https://x.com/IranIntl_En/status/2009020415327522932", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u67", "verified": false, "desc": "Car drove into group of security-force motorcyclists", "desc_fa": "خودرو به گروهی از موتورسواران نیروهای امنیتی برخورد کرد", "coords": [29.5926, 52.5837], "link": "https://x.com/FaytuksNetwork/status/2008586294914675140", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u68", "verified": false, "desc": "Police van on fire", "desc_fa": "ون پلیس در آتش", "coords": [33.6426, 46.4230], "link": "https://x.com/FaytuksNetwork/status/2008623128449098145", "date": "2026-01-07", "size": "medium", "alt": null },
                { "id": "u69", "verified": false, "desc": "Security forces opening fire on protesters", "desc_fa": "نیروهای امنیتی به سمت معترضان آتش گشودند", "coords": [29.1999, 54.3273], "link": "https://x.com/FaytuksNetwork/status/2008625573719920750", "date": "2026-01-07", "size": "big", "alt": "https://x.com/Vahid/status/2008638205503967507, https://x.com/Vahid/status/2008639878746272118" },
                { "id": "u70", "verified": false, "desc": "Reports of gunfire in the capital", "desc_fa": "گزارش تیراندازی در پایتخت", "coords": [35.6892, 51.3890], "link": "https://x.com/FaytuksNetwork/status/2009330102665195784", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u71", "verified": false, "desc": "Something on fire with limited presence of Iranian security forces", "desc_fa": "چیزی در آتش با حضور محدود نیروهای امنیتی ایران", "coords": [35.7785, 51.3731], "link": "https://x.com/FaytuksNetwork/status/2009328429896134916", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u72", "verified": false, "desc": "Reports of unrest/clashes in the area", "desc_fa": "گزارش ناآرامی/درگیری در منطقه", "coords": [38.0800, 46.2920], "link": "https://x.com/FaytuksNetwork/status/2009317493526155362", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u73", "verified": false, "desc": "Locals say protesters set fire to an Islamic seminary", "desc_fa": "بومیان می‌گویند معترضان یک حوزه علمیه را به آتش کشیدند", "coords": [32.2714, 50.9802], "link": "https://x.com/FaytuksNetwork/status/2009321747162735086", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u74", "verified": false, "desc": "Locals say tear gas is used", "desc_fa": "بومیان می‌گویند از گاز اشک‌آور استفاده شده است", "coords": [35.5278, 51.1647], "link": "https://x.com/FaytuksNetwork/status/2009313884268839219", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u75", "verified": false, "desc": "Locals say the provincial governor’s office building was set on fire", "desc_fa": "بومیان می‌گویند ساختمان استانداری استان به آتش کشیده شد", "coords": [36.8416, 54.4347], "link": "https://x.com/FaytuksNetwork/status/2009324798003040693", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u76", "verified": false, "desc": "Reports of street clashes ongoing", "desc_fa": "گزارش درگیری‌های خیابانی ادامه دارد", "coords": [32.4604, 48.3590], "link": "https://x.com/FaytuksNetwork/status/2009317251258962092", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u77", "verified": false, "desc": "Chants and protests", "desc_fa": "شعارها و اعتراضات", "coords": [35.6892, 51.3890], "link": "https://x.com/Vahid/status/2008615094436196660", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u78", "verified": false, "desc": "Chants and protests", "desc_fa": "شعارها و اعتراضات", "coords": [27.1795, 56.2755], "link": "https://x.com/Vahid/status/2008839633468326243", "date": "2026-01-08", "size": "medium", "alt": "https://x.com/Vahid/status/2008840352132968706" },
                { "id": "u79", "verified": false, "desc": "Chants in protests", "desc_fa": "شعار در اعتراضات", "coords": [30.2839, 57.0834], "link": "https://x.com/Vahid/status/2008844818466959368", "date": "2026-01-08", "size": "medium", "alt": "https://x.com/Vahid/status/2008845102224158769, https://x.com/Vahid/status/2008848486054420683, https://x.com/Vahid/status/2008848787469693231" },
                { "id": "u80", "verified": false, "desc": "Chants of \"Javid Shah!\"", "desc_fa": "شعار «جاوید شاه!»", "coords": [33.8938, 48.7563], "link": "https://x.com/Vahid/status/2009020872032702636", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u81", "verified": false, "desc": "Chants of \"This is the last battle, Pahlavi will return!\"", "desc_fa": "شعار «این آخرین نبرده، پهلوی برمی‌گرده!»", "coords": [35.7564, 52.7692], "link": "https://x.com/Vahid/status/2009004746330526120", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u82", "verified": false, "desc": "Chants of \"Javid Shah!\" and tear gas", "desc_fa": "شعار «جاوید شاه!» و گاز اشک‌آور", "coords": [36.8163, 50.8738], "link": "https://x.com/Vahid/status/2009001132966944783", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u83", "verified": false, "desc": "Chants of \"Death to the dictator\" and tear gas and gunshots", "desc_fa": "شعار «مرگ بر دیکتاتور» و گاز اشک‌آور و تیراندازی", "coords": [36.2133, 58.7958], "link": "https://x.com/Vahid/status/2008993328403198201", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u84", "verified": false, "desc": "Chants of \"This is the last battle, Pahlavi will return!\"", "desc_fa": "شعار «این آخرین نبرده، پهلوی برمی‌گرده!»", "coords": [35.7069, 59.8501], "link": "https://x.com/Vahid/status/2008984493567430983", "date": "2026-01-08", "size": "small", "alt": "https://x.com/Vahid/status/2008983459474362371" },
                { "id": "u85", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [36.6455, 59.1212], "link": "https://x.com/Vahid/status/2008975484156301563", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u86", "verified": false, "desc": "Violence by suppressive forces", "desc_fa": "خشونت توسط نیروهای سرکوبگر", "coords": [36.2133, 58.7958], "link": "https://x.com/Vahid/status/2009061187317891475", "date": "2026-01-08", "size": "small", "alt": "https://x.com/Vahid/status/2009059420123353361, https://x.com/Vahid/status/2008990482073112881" },
                { "id": "u87", "verified": false, "desc": "Direct shooting", "desc_fa": "تیراندازی مستقیم", "coords": [30.3430, 48.2810], "link": "https://x.com/Vahid/status/2009059420123353361", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u88", "verified": false, "desc": "Gathering and protests", "desc_fa": "تجمع و اعتراضات", "coords": [37.3739, 49.7485], "link": "https://x.com/Vahid/status/2009057253480124531", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u89", "verified": false, "desc": "Chants of \"Khamenei murderer, your imagination is void!\" and shooting effects", "desc_fa": "شعار «خامنه‌ای قاتل، خیال تو باطل!» و آثار تیراندازی", "coords": [34.3529, 58.6837], "link": "https://x.com/Vahid/status/2009052935368659359", "date": "2026-01-08", "size": "medium", "alt": "https://x.com/Vahid/status/2008970055154119091" },
                { "id": "u90", "verified": false, "desc": "Gathering and protests", "desc_fa": "تجمع و اعتراضات", "coords": [36.2806, 50.0099], "link": "https://x.com/Vahid/status/2009049620123353361", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u91", "verified": false, "desc": "Chants of \"Javid Shah!\" and \"This is the last battle, Pahlavi will return!\"", "desc_fa": "شعارهای «جاوید شاه!» و «این آخرین نبرده، پهلوی برمی‌گرده!»", "coords": [37.5581, 56.9265], "link": "https://x.com/Vahid/status/2009032212700643767", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u92", "verified": false, "desc": "Disabling surveillance camera", "desc_fa": "از کار انداختن دوربین نظارتی", "coords": [32.5553, 51.5097], "link": "https://x.com/Vahid/status/2009027604003606585", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u93", "verified": false, "desc": "Gathering and chants", "desc_fa": "تجمع و شعارها", "coords": [30.2839, 57.0834], "link": "https://x.com/Vahid/status/2009024949080797461", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u94", "verified": false, "desc": "Protesters gathering in the street", "desc_fa": "تجمع معترضان در خیابان", "coords": [35.79932, 51.43340], "link": "https://x.com/Vahid/status/2009388081959297416", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": "u95", "verified": false, "desc": "Protesters gathering at the square", "desc_fa": "تجمع معترضان در میدان", "coords": [35.855938, 50.96175], "link": "https://x.com/Vahid/status/2009386370951692679", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u96", "verified": false, "desc": "Protesters on the street", "desc_fa": "معترضان در خیابان", "coords": [35.78008, 51.45864], "link": "https://x.com/Vahid/status/2009385559844651362", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u97", "verified": false, "desc": "Protesters before the bridge", "desc_fa": "معترضان پیش از پل", "coords": [36.310699, 59.599457], "link": "https://x.com/Vahid/status/2009379779812700545", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": "u98", "verified": false, "desc": "Protesters in the area", "desc_fa": "معترضان در منطقه", "coords": [35.7377, 51.397], "link": "https://x.com/Vahid/status/2009376976159572378", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u99", "verified": false, "desc": "Protesters set fire to police station", "desc_fa": "معترضان پاسگاه پلیس را به آتش کشیدند", "coords": [36.3156, 59.568], "link": "https://x.com/Vahid/status/2009371700106834404", "date": "2026-01-08", "size": "small", "alt": null },
                { "id": "u100", "verified": false, "desc": "Protesters gathering", "desc_fa": "تجمع معترضان", "coords": [36.3445, 59.4543], "link": "https://x.com/Vahid/status/2009371077584003227", "date": "2026-01-08", "size": "medium", "alt": null },
                { "id": "u101", "verified": false, "desc": "Protesters at the square", "desc_fa": "معترضان در میدان", "coords": [31.897423, 54.356857], "link": "https://x.com/Vahid/status/2009369665630282032", "date": "2026-01-08", "size": "big", "alt": "https://x.com/Vahid/status/2009369567257034863" },
                { "id": "u102", "verified": false, "desc": "Protesters gathering", "desc_fa": "تجمع معترضان", "coords": [36.8416, 54.4347], "link": "https://x.com/Vahid/status/2009365859983135071", "date": "2026-01-08", "size": "big", "alt": null },
                { "id": "u103", "verified": false, "desc": "Protesters gathering", "desc_fa": "تجمع معترضان", "coords": [36.8167, 50.8738], "link": "https://x.com/Vahid/status/2009363864597758003", "date": "2026-01-08", "size": "medium", "alt": null }
            ], []);

            const allIncidents = useMemo(() => {
                const combined = showUnverified ? [...verifiedIncidents, ...unverifiedIncidents] : verifiedIncidents;
                return combined.map(i => ({
                    ...i,
                    link: i.link.replace(/^\[|\]\(.*?\)$/g, '').replace(/\)$/, ''),
                    alt: i.alt ? i.alt.replace(/^\[|\]\(.*?\)$/g, '').replace(/\)$/, '').split(',')[0].trim() : null
                }));
            }, [verifiedIncidents, unverifiedIncidents, showUnverified]);

            // --- Timeline Data ---
            const { uniqueDates, minDate, maxDate } = useMemo(() => {
                const dates = [...new Set(allIncidents.map(i => i.date))].sort();
                return { uniqueDates: dates, minDate: dates[0], maxDate: dates[dates.length - 1] };
            }, [allIncidents]);

            // Filter logic
            const displayedIncidents = useMemo(() => {
                if (!dateFilter) return allIncidents;
                return allIncidents.filter(i => i.date === dateFilter);
            }, [allIncidents, dateFilter]);

            // Playback logic
            useEffect(() => {
                let interval;
                if (isPlaying && uniqueDates.length > 0) {
                    interval = setInterval(() => {
                        setDateFilter(currentDate => {
                            if (!currentDate) return uniqueDates[0];
                            const currentIndex = uniqueDates.indexOf(currentDate);
                            if (currentIndex < uniqueDates.length - 1) {
                                return uniqueDates[currentIndex + 1];
                            } else {
                                setIsPlaying(false);
                                return currentDate;
                            }
                        });
                    }, 1500);
                }
                return () => clearInterval(interval);
            }, [isPlaying, uniqueDates]);

            // --- Configuration ---
            const layers = {
                light: { name: 'Light', url: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png' },
                dark: { name: 'Dark', url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png' },
                satellite: { name: 'Satellite', url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}' }
            };

            // --- Map Initialization ---
            useEffect(() => {
                if (!mapContainerRef.current || mapInstanceRef.current) return;
                if (!window.L) {
                    const checkL = setInterval(() => { if (window.L) { clearInterval(checkL); setIsMapReady(true); } }, 100);
                    return;
                } else { setIsMapReady(true); }

                const L = window.L;
                const iranCenter = [32.4279, 53.6880];
                const iranBounds = [[24.5, 43.5], [40.0, 64.0]];

                const map = L.map(mapContainerRef.current, {
                    center: iranCenter,
                    zoom: 5,
                    minZoom: 5,
                    maxZoom: 18,
                    zoomControl: false,
                    maxBounds: iranBounds,
                    maxBoundsViscosity: 1.0,
                    tap: true // Enable tap for mobile
                });

                tileLayerRef.current = L.tileLayer(layers.light.url, { subdomains: 'abcd', maxZoom: 20 }).addTo(map);
                mapInstanceRef.current = map;
                map.on('zoomend', () => setZoomLevel(map.getZoom()));
                setTimeout(() => map.invalidateSize(), 100);
            }, [isMapReady]);

            // --- Handle Markers ---
            useEffect(() => {
                if (!mapInstanceRef.current || !window.L) return;
                const L = window.L;
                const map = mapInstanceRef.current;

                markersRef.current.forEach(marker => marker.remove());
                markersRef.current = [];

                const getColor = (incident) => {
                    if (!incident.verified) return '#9CA3AF'; // Grey-400 for unverified
                    switch (incident.size) {
                        case 'big': return '#EF4444';
                        case 'medium': return '#F97316';
                        default: return '#FACC15'; 
                    }
                };
                // Make markers slightly larger on mobile for easier tapping
                const isMobile = window.innerWidth < 768;
                const getScale = (size) => {
                    const base = isMobile ? 8 : 0;
                    switch (size) {
                        case 'big': return 48 + base;
                        case 'medium': return 40 + base;
                        default: return 32 + base;
                    }
                };

                displayedIncidents.forEach(incident => {
                    const color = getColor(incident);
                    const iconSize = getScale(incident.size);
                    const iconHtml = `
                        <div class="relative group flex items-center justify-center transition-transform active:scale-95 duration-200" style="width: ${iconSize}px; height: ${iconSize}px;">
                            <svg width="${iconSize}" height="${iconSize}" viewBox="0 0 24 24" fill="${color}" style="filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.2)); display: block; opacity: 0.9;">
                                <circle cx="12" cy="12" r="10" />
                            </svg>
                        </div>
                    `;
                    const customIcon = L.divIcon({
                        html: iconHtml,
                        className: 'bg-transparent border-none',
                        iconSize: [iconSize, iconSize],
                        iconAnchor: [iconSize / 2, iconSize],
                        popupAnchor: [0, -iconSize]
                    });

                    const marker = L.marker(incident.coords, { icon: customIcon })
                        .addTo(map)
                        .bindTooltip(`
                            <div class="font-sans text-sm font-semibold px-1 ${lang === 'fa' ? 'text-right' : 'text-center'}" dir="${lang === 'fa' ? 'rtl' : 'ltr'}">
                                <div>
                                    ${lang === 'fa' && incident.desc_fa ? incident.desc_fa : incident.desc}
                                </div>
                                <div class="text-xs text-gray-500 font-normal mt-1 opacity-70">${t.clickForInfo}</div>
                            </div>
                        `, { direction: 'top', offset: [0, -iconSize + 5], opacity: 0.95, className: 'custom-tooltip' });

                    marker.on('click', () => {
                        const L = window.L;
                        setSelectedIncident(incident);
                        setPanelHeight(window.innerHeight * 0.66); // Open to 2/3rds on click

                        // --- SMART CENTERING LOGIC ---
                        if (window.innerWidth < 768) {
                            // On Mobile: Center in the top 34% of the screen (visible area above 66% panel)
                            const mapHeight = map.getSize().y;
                            const targetPanelHeight = window.innerHeight * 0.66;
                            const visibleMapHeight = mapHeight - targetPanelHeight;
                            
                            // We want the point to be at the center of the VISIBLE area
                            // Offset needed = (mapHeight / 2) - (visibleMapHeight / 2) = targetPanelHeight / 2
                            
                            const point = map.project(incident.coords, 14);
                            const targetPoint = L.point(point.x, point.y + (targetPanelHeight / 2));
                            const targetLatLng = map.unproject(targetPoint, 14);
                            
                            map.flyTo(targetLatLng, 14, { duration: 1.5 });
                        } else {
                            map.flyTo(incident.coords, 14, { duration: 1.5 });
                        }
                    });

                    markersRef.current.push(marker);
                });
            }, [isMapReady, displayedIncidents, lang]);

            useEffect(() => {
                if (!isMapReady || window.innerWidth < 768) return;
                markersRef.current.forEach(marker => {
                    if (showAllTooltips) {
                        marker.openTooltip();
                    } else {
                        marker.closeTooltip();
                    }
                });
            }, [isMapReady, showAllTooltips, displayedIncidents]);

            // --- Handle Layer Switching ---
            useEffect(() => {
                if (!mapInstanceRef.current || !window.L) return;
                if (tileLayerRef.current) mapInstanceRef.current.removeLayer(tileLayerRef.current);
                tileLayerRef.current = window.L.tileLayer(layers[activeLayer].url, { subdomains: 'abcd', maxZoom: 20 }).addTo(mapInstanceRef.current);
            }, [activeLayer]);
            
            // --- Sync Zoom Slider ---
            useEffect(() => {
                if (mapInstanceRef.current) {
                    mapInstanceRef.current.setZoom(zoomLevel);
                }
            }, [zoomLevel]);

            // --- Panel Drag Logic ---
            const handleTouchStart = (e) => {
                setIsDragging(true);
                dragStartY.current = e.touches[0].clientY;
                dragStartHeight.current = panelHeight;
            };

            const handleTouchMove = (e) => {
                if (!isDragging) return;
                const deltaY = dragStartY.current - e.touches[0].clientY;
                const newHeight = Math.max(100, Math.min(window.innerHeight - 80, dragStartHeight.current + deltaY));
                setPanelHeight(newHeight);
            };

            const handleTouchEnd = () => {
                setIsDragging(false);
                // Snap logic
                const screenH = window.innerHeight;
                if (panelHeight > screenH * 0.85) {
                    setPanelHeight(screenH * 0.95);
                } else if (panelHeight > screenH * 0.40) {
                    setPanelHeight(screenH * 0.66); // Snap to 2/3rds
                } else {
                    setPanelHeight(100); // Minimized
                    if (panelHeight < 100) setSelectedIncident(null);
                }
            };

            // --- Helpers ---
            const closeModal = () => setSelectedIncident(null);

            const toggleTheme = () => {
                if (activeLayer === 'light') setActiveLayer('dark');
                else setActiveLayer('light');
            };
            const toggleSatellite = () => {
                if (activeLayer === 'satellite') setActiveLayer('light');
                else setActiveLayer('satellite');
            };
            const toggleLang = () => {
                setLang(prev => prev === 'en' ? 'fa' : 'en');
            };

            const resetView = () => {
                if (mapInstanceRef.current) {
                    mapInstanceRef.current.flyTo([32.4279, 53.6880], 5, { duration: 1.5 });
                    setSelectedIncident(null);
                    setShowGraph(false);
                }
            };

            const handleHeaderClick = () => {
                setIsHeaderAnimating(true);
                setTimeout(() => setIsHeaderAnimating(false), 200);
                resetView();
            };

            const glassClass = isDarkMode ? "bg-gray-900/60 border-gray-700/50 text-white" : "bg-white/60 border-white/40 text-gray-700";
            const glassHover = isDarkMode ? "hover:bg-gray-800/80" : "hover:bg-white/80";

            return (
                <div className="relative w-full h-screen bg-gray-100 overflow-hidden font-sans" dir={lang === 'fa' ? 'rtl' : 'ltr'}>
                    
                    <div ref={mapContainerRef} className="absolute inset-0 z-0 bg-slate-200" />

                    {/* Header - Reverted to Full Size */}
                    <div 
                        className={`absolute top-safe pt-2 md:top-6 z-[1000] select-none max-w-[70%] md:max-w-[80vw] group pointer-events-none ${lang === 'fa' ? 'right-4 md:right-6 text-right' : 'left-4 md:left-6 text-left'}`}
                    >
                        <div 
                            className="pointer-events-auto inline-block cursor-pointer active:opacity-80 transition-opacity"
                            onClick={handleHeaderClick}
                        >
                            <h1 
                                className={`text-xl md:text-3xl lg:text-4xl font-extrabold tracking-tight drop-shadow-lg transition-transform duration-200 ${isHeaderAnimating ? 'scale-105' : ''} ${isDarkMode ? 'text-white' : 'text-gray-900'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}
                                title={t.title}
                            >
                                {t.title}
                            </h1>
                            <p className={`text-xs md:text-sm font-medium mt-1 drop-shadow-md transition-colors duration-300 ${isDarkMode ? 'text-gray-200' : 'text-gray-600'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                                {selectedIncident ? t.tapToZoomOut : t.subtitle.replace('{count}', displayedIncidents.length)}
                            </p>
                        </div>
                        
                        {/* Legend - Reverted to Full Size */}
                        <div className={`mt-2 md:mt-3 flex flex-col space-y-1.5 transition-colors duration-300 pointer-events-auto ${isDarkMode ? 'text-gray-200' : 'text-gray-600'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                            <div className="flex items-center text-xs font-medium drop-shadow-md">
                                <span className={`w-2.5 h-2.5 rounded-full bg-red-500 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                {t.largeCrowd}
                            </div>
                            <div className="flex items-center text-xs font-medium drop-shadow-md">
                                <span className={`w-2.5 h-2.5 rounded-full bg-orange-500 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                {t.mediumCrowd}
                            </div>
                            <div className="flex items-center text-xs font-medium drop-shadow-md">
                                <span className={`w-2.5 h-2.5 rounded-full bg-yellow-400 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                {t.smallGroup}
                            </div>
                            {showUnverified && (
                                <div className="flex items-center text-xs font-medium drop-shadow-md animate-fade-in">
                                    <span className={`w-2.5 h-2.5 rounded-full bg-gray-400 shadow-sm ${lang === 'fa' ? 'ml-2' : 'mr-2'}`}></span>
                                    {t.unverified}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Top Controls */}
                    <div className={`absolute top-safe pt-2 md:top-6 z-[1000] flex flex-col space-y-2 md:space-y-3 items-end ${lang === 'fa' ? 'left-4 md:left-6 items-start' : 'right-4 md:right-6 items-end'}`}>
                        <div className={`backdrop-blur-xl shadow-xl rounded-full p-1.5 md:p-1.5 border flex items-center space-x-2 transition-colors duration-300 ${glassClass} ${lang === 'fa' ? 'space-x-reverse' : ''}`}>
                            <button onClick={toggleTheme} className={`p-2 md:p-2.5 rounded-full transition-all duration-200 ${glassHover} active:scale-95`} title="Toggle Light/Dark">
                                {activeLayer === 'light' ? <IconSun className="w-5 h-5" /> : <IconMoon className="w-5 h-5" />}
                            </button>
                            <button onClick={toggleSatellite} className={`p-2 md:p-2.5 rounded-full transition-all duration-200 text-base md:text-lg leading-none active:scale-95 ${activeLayer === 'satellite' ? 'bg-blue-600/80 text-white' : glassHover}`} title="Satellite View">
                                🛰️
                            </button>
                            <button onClick={toggleLang} className={`p-2 md:p-2.5 rounded-full transition-all duration-200 font-bold text-xs active:scale-95 ${glassHover}`} title="Switch Language">
                                {lang === 'en' ? <span className="font-[Vazirmatn] text-[10px] md:text-xs">فارسی</span> : 'EN'}
                            </button>
                        </div>

                        <div className="flex flex-col gap-2 items-end">
                             <button 
                                onClick={() => setShowGraph(true)} 
                                className={`backdrop-blur-xl shadow-xl rounded-full px-3 py-2 md:px-4 md:py-2 border flex items-center justify-center space-x-2 text-xs md:text-sm font-semibold transition-all duration-200 active:scale-95 ${glassClass} ${glassHover} ${lang === 'fa' ? 'space-x-reverse font-[Vazirmatn]' : ''}`}
                            >
                                <IconChart className="w-5 h-5" />
                                <span>{t.showChart}</span>
                            </button>

                             <button 
                                onClick={() => setShowUnverified(!showUnverified)} 
                                className={`backdrop-blur-xl shadow-xl rounded-full px-3 py-2 md:px-4 md:py-2 border flex items-center justify-center space-x-2 text-xs md:text-sm font-semibold transition-all duration-200 active:scale-95 ${glassClass} ${glassHover} ${lang === 'fa' ? 'space-x-reverse font-[Vazirmatn]' : ''}`}
                            >
                                <IconAlert className="w-5 h-5" />
                                <span>{showUnverified ? t.hideUnverified : t.showUnverified}</span>
                            </button>
                        </div>
                    </div>

                    {/* Timeline Slider (Bottom Center) - Safe Area Aware */}
                    <div className={`absolute bottom-6 md:bottom-8 left-0 right-0 z-[1000] px-4 md:px-0 flex justify-center mb-safe transition-all duration-300 ${selectedIncident ? 'translate-y-[150%] md:translate-y-0 opacity-0 md:opacity-100 pointer-events-none md:pointer-events-auto' : ''}`}>
                         <div className={`w-full max-w-xl backdrop-blur-xl shadow-2xl rounded-2xl p-3 md:p-4 border flex flex-col space-y-3 transition-colors duration-300 timeline-flag-glass pointer-events-auto ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                            <div className={`flex justify-between items-center text-xs font-bold uppercase tracking-wide opacity-90 ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>
                                <span>{t.timeline}</span>
                                <span>{dateFilter ? formatDateWithWeekday(dateFilter, lang) : t.showingAll}</span>
                            </div>
                            
                            <div className={`flex items-center space-x-3 md:space-x-4 ${lang === 'fa' ? 'space-x-reverse' : ''}`}>
                                <button 
                                    onClick={() => setIsPlaying(!isPlaying)}
                                    className={`p-2.5 rounded-full transition-colors active:scale-95 ${isPlaying ? 'bg-gray-700 text-white' : 'bg-gray-900 text-white hover:bg-gray-700'}`}
                                    title={isPlaying ? "Pause" : "Play Timeline"}
                                >
                                    {isPlaying ? <IconPause className="w-4 h-4" /> : <IconPlay className="w-4 h-4" />}
                                </button>

                                <div className="flex-1 relative flex items-center h-8">
                                    <input 
                                        type="range" 
                                        min="0" 
                                        max={uniqueDates.length - 1} 
                                        value={dateFilter ? uniqueDates.indexOf(dateFilter) : 0} 
                                        onChange={(e) => {
                                            setIsPlaying(false); 
                                            setDateFilter(uniqueDates[e.target.value]);
                                        }}
                                        disabled={!dateFilter && isPlaying}
                                        className={`w-full h-8 bg-transparent rounded-lg appearance-none cursor-pointer z-10 ${lang === 'fa' ? 'rotate-180' : ''}`}
                                    />
                                    {/* Visual Track */}
                                    <div className="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-1.5 bg-gray-500/20 rounded-full pointer-events-none">
                                         <div 
                                            className="h-full bg-blue-500/50 rounded-full" 
                                            style={{ 
                                                width: `${dateFilter ? (uniqueDates.indexOf(dateFilter) / (uniqueDates.length - 1)) * 100 : 0}%`,
                                                transition: 'width 0.1s' 
                                            }}
                                         ></div>
                                    </div>
                                </div>

                                <button 
                                    onClick={() => { setIsPlaying(false); setDateFilter(null); }} 
                                    className={`px-3 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-colors border active:scale-95 ${!dateFilter ? 'bg-gray-800 border-gray-800 text-white' : 'border-gray-600 text-gray-700 hover:bg-gray-800 hover:text-white'}`}
                                >
                                    {t.all}
                                </button>
                            </div>
                         </div>
                    </div>

                    {/* Graph Modal */}
                    {showGraph && (
                        <ProtestGraph
                            data={allIncidents}
                            onClose={() => setShowGraph(false)}
                            isDarkMode={isDarkMode}
                            t={t}
                            lang={lang}
                            showUnverified={showUnverified}
                            onToggleUnverified={() => setShowUnverified(!showUnverified)}
                        />
                    )}

                    {/* Details Panel - Draggable & Resizable on Mobile */}
                    {selectedIncident && (
                        <div 
                            className={`fixed inset-0 z-[2000] flex pointer-events-none flex-col justify-end md:justify-start ${lang === 'fa' ? 'md:items-start' : 'md:items-end'}`}
                        >
                            
                            {/* Mobile Drag Panel */}
                            <div 
                                className={`
                                    pointer-events-auto relative 
                                    w-full md:w-full md:max-w-md 
                                    md:h-full 
                                    rounded-t-3xl md:rounded-none md:rounded-l-none
                                    shadow-2xl overflow-hidden flex flex-col 
                                    ${isDarkMode ? 'bg-gray-900 md:bg-gray-900/80 border-gray-700/50' : 'bg-white md:bg-white/80 border-white/50'}
                                    ${lang === 'fa' ? 'md:border-r md:animate-panel-desktop-rtl' : 'md:border-l md:animate-panel-desktop-ltr'}
                                    md:backdrop-blur-xl border-t md:border-t-0
                                `} 
                                style={{ 
                                    height: window.innerWidth < 768 ? panelHeight : '100%', 
                                    transition: isDragging ? 'none' : 'height 0.3s cubic-bezier(0.16, 1, 0.3, 1)' 
                                }}
                                dir={lang === 'fa' ? 'rtl' : 'ltr'}
                            >
                                {/* Drag Handle Area (Mobile Only) */}
                                <div 
                                    className="md:hidden w-full flex justify-center py-3 cursor-grab active:cursor-grabbing touch-none bg-inherit border-b border-gray-200/10"
                                    onTouchStart={handleTouchStart}
                                    onTouchMove={handleTouchMove}
                                    onTouchEnd={handleTouchEnd}
                                >
                                    <div className="w-12 h-1.5 bg-gray-300/50 rounded-full"></div>
                                </div>

                                {/* Desktop Header / Mobile Secondary Header */}
                                <div className={`px-6 py-3 md:py-4 border-b flex justify-between items-center ${isDarkMode ? 'bg-gray-900/50 border-gray-800' : 'bg-white/50 border-gray-100'}`}>
                                    <h2 className={`text-lg md:text-xl font-bold leading-tight ${isDarkMode ? 'text-white' : 'text-gray-900'} ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>{t.incidentDetails}</h2>
                                    <button onClick={closeModal} className={`p-2 rounded-full transition-colors active:scale-95 ${isDarkMode ? 'hover:bg-gray-800 text-gray-400' : 'hover:bg-gray-100 text-gray-500'}`}>
                                        <IconX className="w-6 h-6" />
                                    </button>
                                </div>

                                <div className={`flex-1 overflow-y-auto p-6 space-y-6 pb-safe ${lang === 'fa' ? 'font-[Vazirmatn]' : ''}`}>
                                    
                                    {/* Mobile Compact Metadata Row - FIXED for Dark Mode */}
                                    <div className={`md:hidden flex items-center justify-between text-xs space-x-4 border-b pb-4 ${isDarkMode ? 'text-gray-200 border-gray-700' : 'text-gray-600 border-gray-200'}`}>
                                        <div className="flex items-center space-x-1.5 opacity-90">
                                            <IconCalendar className="w-3.5 h-3.5" />
                                            <span>{formatDateWithWeekday(selectedIncident.date, lang)}</span>
                                        </div>
                                        <div className="flex items-center space-x-1.5 opacity-90 truncate">
                                            <IconMapPin className="w-3.5 h-3.5" />
                                            <span className="truncate">{selectedIncident.coords[0].toFixed(3)}, {selectedIncident.coords[1].toFixed(3)}</span>
                                        </div>
                                    </div>

                                    {/* Desktop Grid Layout (Hidden on Mobile) */}
                                    <div className="hidden md:grid grid-cols-2 gap-4">
                                        <div className={`p-3 rounded-xl border ${isDarkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50/50 border-gray-100'}`}>
                                            <div className={`flex items-center text-gray-500 mb-1 text-xs uppercase tracking-wide font-bold`}>
                                                <IconCalendar className={`w-4 h-4 ${lang === 'fa' ? 'ml-1.5' : 'mr-1.5'}`} /> 
                                                {t.date}
                                            </div>
                                            <div className={`font-semibold ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>{formatDateWithWeekday(selectedIncident.date, lang)}</div>
                                        </div>
                                        <div className={`p-3 rounded-xl border ${isDarkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50/50 border-gray-100'}`}>
                                            <div className={`flex items-center text-gray-500 mb-1 text-xs uppercase tracking-wide font-bold`}>
                                                <IconMapPin className={`w-4 h-4 ${lang === 'fa' ? 'ml-1.5' : 'mr-1.5'}`} /> 
                                                {t.location}
                                            </div>
                                            <div className={`font-mono text-xs md:text-sm font-semibold ${isDarkMode ? 'text-gray-200' : 'text-gray-800'} ${lang === 'fa' ? 'text-left' : ''} text-left`} dir="ltr">
                                                {selectedIncident.coords[0].toFixed(3)}, {selectedIncident.coords[1].toFixed(3)}
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        {/* Cleaner Description UI */}
                                        <div className={`leading-relaxed text-sm md:text-base font-medium ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>
                                            {lang === 'fa' && selectedIncident.desc_fa ? selectedIncident.desc_fa : selectedIncident.desc}
                                        </div>
                                    </div>

                                    <div className="space-y-6 pb-8">
                                        <div>
                                            <div className="flex items-center justify-between mb-3">
                                                <h3 className={`text-sm font-bold uppercase tracking-wide ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.footage}</h3>
                                                <a href={selectedIncident.link} target="_blank" rel="noreferrer" className="text-xs text-blue-500 hover:underline flex items-center p-2 -mr-2">
                                                    {t.viewOnX} <IconExternalLink className="w-3 h-3 ml-1" />
                                                </a>
                                            </div>
                                            <TweetEmbed url={selectedIncident.link} isDarkMode={isDarkMode} />
                                        </div>
                                        {selectedIncident.alt && (
                                            <div>
                                                <div className="flex items-center justify-between mb-3">
                                                    <h3 className={`text-sm font-bold uppercase tracking-wide ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.altAngle}</h3>
                                                    <a href={selectedIncident.alt.split(',')[0]} target="_blank" rel="noreferrer" className="text-xs text-blue-500 hover:underline flex items-center p-2 -mr-2">
                                                        {t.viewOnX} <IconExternalLink className="w-3 h-3 ml-1" />
                                                    </a>
                                                </div>
                                                <TweetEmbed url={selectedIncident.alt} isDarkMode={isDarkMode} />
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<IranMap />);
    </script>
</body>
</html>
